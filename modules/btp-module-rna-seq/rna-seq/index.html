
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This contains all material for Markdown version of BTP workshops.">
      
      
        <meta name="author" content="Authors">
      
      
      
        <link rel="prev" href="../../btp-module-chip-seq/chip-seq/">
      
      
        <link rel="next" href="../../btp-module-ngs-bio/biol/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.2">
    
    
      
        <title>RNA-Seq - Markdown Manuals for Bioinformatics Training Platform (BTP)</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.f56500e0.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/details.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#key-learning-outcomes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Markdown Manuals for Bioinformatics Training Platform (BTP)" class="md-header__button md-logo" aria-label="Markdown Manuals for Bioinformatics Training Platform (BTP)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Markdown Manuals for Bioinformatics Training Platform (BTP)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RNA-Seq
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Markdown Manuals for Bioinformatics Training Platform (BTP)" class="md-nav__button md-logo" aria-label="Markdown Manuals for Bioinformatics Training Platform (BTP)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Markdown Manuals for Bioinformatics Training Platform (BTP)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../trainers/trainers/" class="md-nav__link">
        The Trainers
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Timetable
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Timetable" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Timetable
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../timetables/timetable_introNGS/" class="md-nav__link">
        Intro to NGS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../timetables/timetable_cancer/" class="md-nav__link">
        Cancer Genomics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../timetables/timetable_longRead/" class="md-nav__link">
        Long Read
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../preamble/" class="md-nav__link">
        Workshop Information
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Introduction to NGS Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction to NGS Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Introduction to NGS Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-ngs-cli/commandline/" class="md-nav__link">
        Introduction to Command Line
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-ngs-qc/ngs-qc/" class="md-nav__link">
        Data Quality
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-ngs-mapping/alignment/" class="md-nav__link">
        Read Alignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-chip-seq/chip-seq/" class="md-nav__link">
        ChIP-seq
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          RNA-Seq
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        RNA-Seq
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-learning-outcomes" class="md-nav__link">
    Key Learning Outcomes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-youll-be-using" class="md-nav__link">
    Resources You’ll be Using
  </a>
  
    <nav class="md-nav" aria-label="Resources You’ll be Using">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tools-used" class="md-nav__link">
    Tools Used
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sources-of-data" class="md-nav__link">
    Sources of Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author-information" class="md-nav__link">
    Author Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-environment" class="md-nav__link">
    Prepare the Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alignment" class="md-nav__link">
    Alignment
  </a>
  
    <nav class="md-nav" aria-label="Alignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alignment-visualisation-in-igv" class="md-nav__link">
    Alignment Visualisation in IGV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-gene-counts" class="md-nav__link">
    Generating Gene Counts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isoform-expression-and-transcriptome-assembly" class="md-nav__link">
    Isoform Expression and Transcriptome Assembly
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differential-gene-expression-analysis-using-edger" class="md-nav__link">
    Differential Gene Expression Analysis using edgeR
  </a>
  
    <nav class="md-nav" aria-label="Differential Gene Expression Analysis using edgeR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#experiment-design" class="md-nav__link">
    Experiment Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-the-environment_1" class="md-nav__link">
    Prepare the Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-in-data" class="md-nav__link">
    Read in Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-gene-annotation" class="md-nav__link">
    Add Gene annotation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-checks" class="md-nav__link">
    Data checks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-for-differential-expression" class="md-nav__link">
    Testing for Differential Expression
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differential-expression-using-the-voom-function-and-the-limma-package" class="md-nav__link">
    Differential expression using the Voom function and the limma package
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-visualisation" class="md-nav__link">
    Data Visualisation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differential-expression-using-cuffdiff" class="md-nav__link">
    Differential Expression using cuffdiff
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualising-the-cuffdiff-expression-analysis" class="md-nav__link">
    Visualising the CuffDiff expression analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-ngs-bio/biol/" class="md-nav__link">
        NGS Biological Insight
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-velvet/velvet/" class="md-nav__link">
        de novo Genome Assembly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-denovo-canu/denovo_canu/" class="md-nav__link">
        DeNovo Canu
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Cancer Genomics Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cancer Genomics Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Cancer Genomics Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-alignment/alignment/" class="md-nav__link">
        Read Alignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-snv/snv/" class="md-nav__link">
        Single Nucleotide Variant Calling and Annotation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-cnv/cnv-tut/" class="md-nav__link">
        Copy Number Variation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-sv/sv_tut/" class="md-nav__link">
        Structural Variant Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-viz/visu/" class="md-nav__link">
        Variant Visualisation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" type="checkbox" id="__nav_6_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_6">
          Somatic Mutations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Somatic Mutations" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_6">
          <span class="md-nav__icon md-icon"></span>
          Somatic Mutations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-somatic/01_signatures/" class="md-nav__link">
        Assessing somatic mutational signatures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-somatic/02_intogen/" class="md-nav__link">
        Cohort analysis for the identification of driver genes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          DeNovo Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DeNovo Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          DeNovo Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../denovo-module-bac/bac_asm/" class="md-nav__link">
        Bacterial Assembly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../denovo-module-euk/eukaryotic_assem/" class="md-nav__link">
        Eukaryote Assembly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../denovo-module-scaffolding/scaffold/" class="md-nav__link">
        Scaffolding
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Metagenomics Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metagenomics Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Metagenomics Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metagenomics-module-qc/ngs-qc/" class="md-nav__link">
        Metagenomics QC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metagenomics-module-tax/tax/" class="md-nav__link">
        Metagenomics Taxonomic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metagenomics-module-vis/vis/" class="md-nav__link">
        Metagenomics Visualisation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metagenomics-module-wga/wga/" class="md-nav__link">
        Metagenomics WGA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metagenomics-module-fda/fda/" class="md-nav__link">
        Metagenomics Functional Analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-learning-outcomes" class="md-nav__link">
    Key Learning Outcomes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-youll-be-using" class="md-nav__link">
    Resources You’ll be Using
  </a>
  
    <nav class="md-nav" aria-label="Resources You’ll be Using">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tools-used" class="md-nav__link">
    Tools Used
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sources-of-data" class="md-nav__link">
    Sources of Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author-information" class="md-nav__link">
    Author Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-the-environment" class="md-nav__link">
    Prepare the Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alignment" class="md-nav__link">
    Alignment
  </a>
  
    <nav class="md-nav" aria-label="Alignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alignment-visualisation-in-igv" class="md-nav__link">
    Alignment Visualisation in IGV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-gene-counts" class="md-nav__link">
    Generating Gene Counts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isoform-expression-and-transcriptome-assembly" class="md-nav__link">
    Isoform Expression and Transcriptome Assembly
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differential-gene-expression-analysis-using-edger" class="md-nav__link">
    Differential Gene Expression Analysis using edgeR
  </a>
  
    <nav class="md-nav" aria-label="Differential Gene Expression Analysis using edgeR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#experiment-design" class="md-nav__link">
    Experiment Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-the-environment_1" class="md-nav__link">
    Prepare the Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-in-data" class="md-nav__link">
    Read in Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-gene-annotation" class="md-nav__link">
    Add Gene annotation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-checks" class="md-nav__link">
    Data checks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-for-differential-expression" class="md-nav__link">
    Testing for Differential Expression
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differential-expression-using-the-voom-function-and-the-limma-package" class="md-nav__link">
    Differential expression using the Voom function and the limma package
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-visualisation" class="md-nav__link">
    Data Visualisation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differential-expression-using-cuffdiff" class="md-nav__link">
    Differential Expression using cuffdiff
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualising-the-cuffdiff-expression-analysis" class="md-nav__link">
    Visualising the CuffDiff expression analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>RNA-Seq</h1>

<h2 id="key-learning-outcomes">Key Learning Outcomes<a class="headerlink" href="#key-learning-outcomes" title="Permanent link">&para;</a></h2>
<p>After completing this practical the trainee should be able to:</p>
<ul>
<li>
<p>Understand and perform a simple RNA-Seq analysis workflow.</p>
</li>
<li>
<p>Perform spliced alignments to an indexed reference genome using
    TopHat.</p>
</li>
<li>
<p>Visualize spliced transcript alignments in a genome browser such as
    IGV.</p>
</li>
<li>
<p>Be able to identify differential gene expression between two
    experimental conditions.</p>
</li>
<li>
<p>Be familiar with R environment and be able to run R based RNA-seq
    packages.</p>
</li>
</ul>
<p>We also have bonus exercises where you can learn to:</p>
<ul>
<li>
<p>Perform transcript assembly using Cufflinks.</p>
</li>
<li>
<p>Run cuffdiff, a Cufflinks utility for differential expression
    analysis.</p>
</li>
<li>
<p>Visualize transcript alignments and annotation in a genome browser
    such as IGV.</p>
</li>
</ul>
<h2 id="resources-youll-be-using">Resources You’ll be Using<a class="headerlink" href="#resources-youll-be-using" title="Permanent link">&para;</a></h2>
<h3 id="tools-used">Tools Used<a class="headerlink" href="#tools-used" title="Permanent link">&para;</a></h3>
<p>Tophat:<br />
<a href="https://ccb.jhu.edu/software/tophat/index.shtml">https://ccb.jhu.edu/software/tophat/index.shtml</a></p>
<p>Cufflinks:<br />
<a href="http://cole-trapnell-lab.github.io/cufflinks/">http://cole-trapnell-lab.github.io/cufflinks/</a></p>
<p>Samtools:<br />
<a href="http://www.htslib.org/">http://www.htslib.org/</a></p>
<p>BEDTools:<br />
<a href="https://github.com/arq5x/bedtools2">https://github.com/arq5x/bedtools2</a></p>
<p>UCSC tools:<br />
<a href="http://hgdownload.cse.ucsc.edu/admin/exe/">http://hgdownload.cse.ucsc.edu/admin/exe/</a></p>
<p>IGV:<br />
<a href="http://www.broadinstitute.org/igv/">http://www.broadinstitute.org/igv/</a></p>
<p>FeatureCount:<br />
<a href="http://subread.sourceforge.net/">http://subread.sourceforge.net/</a></p>
<p>edgeR package:<br />
<a href="https://bioconductor.org/packages/release/bioc/html/edgeR.html">https://bioconductor.org/packages/release/bioc/html/edgeR.html</a></p>
<p>CummeRbund manual:<br />
<a href="http://www.bioconductor.org/packages/release/bioc/vignettes/cummeRbund/inst/doc/cummeRbund-manual.pdf">http://www.bioconductor.org/packages/release/bioc/vignettes/cummeRbund/inst/doc/cummeRbund-manual.pdf</a></p>
<h3 id="sources-of-data">Sources of Data<a class="headerlink" href="#sources-of-data" title="Permanent link">&para;</a></h3>
<p><a href="http://www.ebi.ac.uk/ena/data/view/ERR022484">http://www.ebi.ac.uk/ena/data/view/ERR022484</a><br />
<a href="http://www.ebi.ac.uk/ena/data/view/ERR022485">http://www.ebi.ac.uk/ena/data/view/ERR022485</a><br />
<a href="http://www.pnas.org/content/suppl/2008/12/16/0807121105.DCSupplemental">http://www.pnas.org/content/suppl/2008/12/16/0807121105.DCSupplemental</a></p>
<h2 id="author-information">Author Information<a class="headerlink" href="#author-information" title="Permanent link">&para;</a></h2>
<p><em>Primary Author(s):</em>
    Susan M Corley <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#46;&#99;&#111;&#114;&#108;&#101;&#121;&#64;&#117;&#110;&#115;&#119;&#46;&#101;&#100;&#117;&#46;&#97;&#117;">&#115;&#46;&#99;&#111;&#114;&#108;&#101;&#121;&#64;&#117;&#110;&#115;&#119;&#46;&#101;&#100;&#117;&#46;&#97;&#117;</a>
    Sonika Tyagi <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#111;&#110;&#105;&#107;&#97;&#46;&#116;&#121;&#97;&#103;&#105;&#64;&#97;&#103;&#114;&#102;&#46;&#111;&#114;&#103;&#46;&#97;&#117;">&#115;&#111;&#110;&#105;&#107;&#97;&#46;&#116;&#121;&#97;&#103;&#105;&#64;&#97;&#103;&#114;&#102;&#46;&#111;&#114;&#103;&#46;&#97;&#117;</a>   </p>
<p><em>Contributor(s):</em>
    Nathan S. Watson-Haigh <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#110;&#97;&#116;&#104;&#97;&#110;&#46;&#104;&#97;&#105;&#103;&#104;&#64;&#97;&#99;&#112;&#102;&#103;&#46;&#99;&#111;&#109;&#46;&#97;&#117;">&#110;&#97;&#116;&#104;&#97;&#110;&#46;&#104;&#97;&#105;&#103;&#104;&#64;&#97;&#99;&#112;&#102;&#103;&#46;&#99;&#111;&#109;&#46;&#97;&#117;</a> 
    Myrto Kostadima, EMBL-EBI <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#107;&#111;&#115;&#116;&#97;&#100;&#109;&#105;&#64;&#101;&#98;&#105;&#46;&#97;&#99;&#46;&#117;&#107;">&#107;&#111;&#115;&#116;&#97;&#100;&#109;&#105;&#64;&#101;&#98;&#105;&#46;&#97;&#99;&#46;&#117;&#107;</a> 
    Remco Loos, EMBL-EBI <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#114;&#101;&#109;&#99;&#111;&#64;&#101;&#98;&#105;&#46;&#97;&#99;&#46;&#117;&#107;">&#114;&#101;&#109;&#99;&#111;&#64;&#101;&#98;&#105;&#46;&#97;&#99;&#46;&#117;&#107;</a></p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>The goal of this hands-on session is to perform some basic tasks in the
downstream analysis of RNA-seq data.</p>
<p>First we will use RNA-seq data from zebrafish. You will align one set of
reads to the zebrafish using Tophat2. You will then view the aligned
reads using the IGV viewer. We will also demonstrate how gene counts can
be derived from this data. You will go on to assembly a transcriptome
from the read data using cufflinks. We will show you how this type of
data may be analysed for differential expression.</p>
<p>The second part of the tutorial will focus on RNA-seq data from a human
experiment (cancer cell line versus normal cells). You will use the
Bioconductor packages edgeR and voom (limma) to determine differential
gene expression. The results from this analysis will then be used in the
final session which introduces you to some of the tools used to gain
biological insight into the results of a differential expression
analysis</p>
<h2 id="prepare-the-environment">Prepare the Environment<a class="headerlink" href="#prepare-the-environment" title="Permanent link">&para;</a></h2>
<p>We will use a dataset derived from sequencing of mRNA from <code>Danio rerio</code>
embryos in two different developmental stages. Sequencing was performed
on the Illumina platform and generated 76bp paired-end sequence data
using polyA selected RNA. Due to the time constraints of the practical
we will only use a subset of the reads.</p>
<p>The data files are contained in the subdirectory called <code>data</code> and are
the following:</p>
<p><code>2cells_1.fastq</code> and <code>2cells_2.fastq</code>
    These files are based on RNA-seq data of a 2-cell zebrafish embryo</p>
<p><code>6h_1.fastq</code> and <code>6h_2.fastq</code>
    These files are based on RNA-seq data of zebrafish embryos 6h post
    fertilization</p>
<p>Open the Terminal and go to the <code>rnaseq</code> working directory:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>cd /home/trainee/rnaseq/
</code></pre></div></td></tr></table></div>

<div class="admonition failure">
<p class="admonition-title">STOP</p>
<p>All commands entered into the terminal for this tutorial should be from
within the <strong><code>/home/trainee/rnaseq</code></strong> directory.</p>
</div>
<p>Check that the <code>data</code> directory contains the above-mentioned files by
typing:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>ls data
</code></pre></div></td></tr></table></div>

<h2 id="alignment">Alignment<a class="headerlink" href="#alignment" title="Permanent link">&para;</a></h2>
<p>There are numerous tools for performing short read alignment and the
choice of aligner should be carefully made according to the analysis
goals/requirements. Here we will use Tophat2, a widely used ultrafast
aligner that performs spliced alignments.</p>
<p>Tophat2 is based on the Bowtie2 aligner and uses an indexed genome for
the alignment to speed up the alignment and keep its memory footprint
small. The the index for the <code>Danio rerio</code> genome has been created for
you.</p>
<div class="admonition failure">
<p class="admonition-title">STOP</p>
<p>The command to create an index is as follows. You DO NOT need to run this command yourself - we have done this for you.</p>
<p><strong><code>bowtie2-build genome/Danio_rerio.Zv9.66.dna.fa genome/ZV9</code></strong></p>
</div>
<p>Tophat2 has a number of parameters in order to perform the alignment. To
view them all type:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tophat2 --help
</code></pre></div></td></tr></table></div>

<p>The general format of the tophat2 command is:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">tophat2</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]*</span><span class="w"> </span><span class="o">&lt;</span><span class="n">index_base</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">reads_1</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">reads_2</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>

<p>Where the last two arguments are the <code>.fastq</code> files of the paired end
reads, and the argument before is the basename of the indexed genome.</p>
<p>The quality values in the FASTQ files used in this hands-on session are
Phred+33 encoded. We explicitly tell tophat of this fact by using the
command line argument <code>–solexa-quals</code>.</p>
<p>You can look at the first few reads in the file <code>data/2cells_1.fastq</code>
with:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>head -n 20 data/2cells_1.fastq
</code></pre></div></td></tr></table></div>

<p>Some other parameters that we are going to use to run Tophat are listed
below:</p>
<p>-g
:   Maximum number of multihits allowed. Short reads are likely to map
    to more than one location in the genome even though these reads can
    have originated from only one of these regions. In RNA-seq we allow
    for a limited number of multihits, and in this case we ask Tophat to
    report only reads that map at most onto 2 different loci.</p>
<p>–library-type
:   Before performing any type of RNA-seq analysis you need to know a
    few things about the library preparation. Was it done using a
    strand-specific protocol or not? If yes, which strand? In our data
    the protocol was NOT strand specific.</p>
<p>-j
:   Improve spliced alignment by providing Tophat with annotated splice
    junctions. Pre-existing genome annotation is an advantage when
    analysing RNA-seq data. This file contains the coordinates of
    annotated splice junctions from Ensembl. These are stored under the
    sub-directory <code>annotation</code> in a file called <code>ZV9.spliceSites</code>.</p>
<p>-o
:   This specifies in which subdirectory Tophat should save the output
    files. Given that for every run the name of the output files is the
    same, we specify different directories for each run.</p>
<p>It takes some time (approx. 20 min) to perform tophat spliced
alignments, on this small subset of reads. Therefore, we have
pre-aligned the <code>2cells</code> data for you using the following command:</p>
<p>You DO NOT need to run this command yourself - we have done this for
you.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tophat2 --solexa-quals -g 2 --library-type fr-unstranded -j annotation/Danio_rerio.Zv9.66.spliceSites -o tophat/ZV9_2cells genome/ZV9 data/2cells_1.fastq data/2cells_2.fastq
</code></pre></div></td></tr></table></div>

<p>Align the <code>6h</code> data yourself using the following command:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code># Takes approx. 20mins
tophat2 --solexa-quals -g 2 --library-type fr-unstranded -j annotation/Danio_rerio.Zv9.66.spliceSites -o tophat/ZV9_6h genome/ZV9 data/6h_1.fastq data/6h_2.fastq
</code></pre></div></td></tr></table></div>

<p>The <code>6h</code> read alignment will take approx. 20 min to complete. Therefore,
we’ll take a look at some of the files, generated by tophat, for the
pre-computed <code>2cells</code> data.</p>
<p>Tophat generates several files in the specified output directory. The
most important files are listed below.</p>
<p>accepted_hits.bam
:   This file contains the list of read alignments in BAM format.</p>
<p>align_summary.txt
:   Provides a detailed summary of the read-alignments.</p>
<p>unmapped.bam
:   This file contains the unmapped reads.</p>
<p>The complete documentation can be found at:
<a href="https://ccb.jhu.edu/software/tophat/manual.shtml">https://ccb.jhu.edu/software/tophat/manual.shtml</a></p>
<h3 id="alignment-visualisation-in-igv">Alignment Visualisation in IGV<a class="headerlink" href="#alignment-visualisation-in-igv" title="Permanent link">&para;</a></h3>
<p>The Integrative Genomics Viewer (IGV) is able to provide a visualisation
of read alignments given a reference sequence and a BAM file. We’ll
visualise the information contained in the <code>accepted_hits.bam</code> and
<code>junctions.bed</code> files for the pre-computed <code>2cells</code> data. The former,
contains the tophat spliced alignments of the reads to the reference
while the latter stores the coordinates of the splice junctions present
in the data set.</p>
<p>Open the <code>rnaseq</code> directory on your Desktop and double-click the
<code>tophat</code> subdirectory and then the <code>ZV9_2cells</code> directory.</p>
<ol>
<li>
<p>Launch IGV by double-clicking the “IGV 2.3.*” icon on the Desktop
    (ignore any warnings that you may get as it opens). <em>NOTE: IGV may
    take several minutes to load for the first time, please be patient.</em></p>
</li>
<li>
<p>Choose “Zebrafish (Zv9)” from the drop-down box in the top left of
    the IGV window. Else you can also load the genome fasta file.</p>
</li>
<li>
<p>Load the <code>accepted_hits.sorted.bam</code> file by clicking the “File”
    menu, selecting “Load from File” and navigating to the
    <code>Desktop/rnaseq/tophat/ZV9_2cells</code> directory.</p>
</li>
<li>
<p>Rename the track by right-clicking on its name and choosing “Rename
    Track”. Give it a meaningful name like “2cells BAM”.</p>
</li>
<li>
<p>Load the <code>junctions.bed</code> from the same directory and rename the
    track “2cells Junctions BED”.</p>
</li>
<li>
<p>Load the Ensembl annotations file <code>Danio_rerio.Zv9.66.gtf</code> stored in
    the <code>rnaseq/annotation</code> directory.</p>
</li>
<li>
<p>Navigate to a region on chromosome 12 by typing
    <code>chr12:20,270,921-20,300,943</code> into the search box at the top of the
    IGV window.</p>
</li>
</ol>
<p>Keep zooming to view the bam file alignments</p>
<p>Some useful IGV manuals can be found below</p>
<p><a href="http://www.broadinstitute.org/software/igv/interpreting_insert_size">http://www.broadinstitute.org/software/igv/interpreting_insert_size</a><br />
<a href="http://www.broadinstitute.org/software/igv/alignmentdata">http://www.broadinstitute.org/software/igv/alignmentdata</a>  </p>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Does the file ’align_summary.txt’ look interesting? What information does it provide?</p>
</div>
<div class="admonition success">
<details>
<summary><strong>Answer</strong></summary>
<p>As the name suggests, the file provides a details summary of the alignment statistics.</p>
</details>
</div>
<p>One other important file is ’unmapped.bam’. This file contains the
unampped reads.</p>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Can you identify the splice junctions from the BAM file?</p>
</div>
<div class="admonition success">
<details>
<summary><strong>Answer</strong></summary>
<p>Splice junctions can be identified in the alignment BAM files. These are the aligned RNA-Seq reads that have skipped-bases from the reference genome (most likely introns).</p>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Are the junctions annotated for <code>CBY1</code> consistent with the annotation?</p>
</div>
<div class="admonition success">
<details>
<summary><strong>Answer</strong></summary>
<p>Read alignment supports an extended length in exon 5 to the gene model(cby1-001)</p>
</details>
</div>
<p>Once tophat finishes aligning the 6h data you will need to sort the
alignments found in the BAM file and then index the sorted BAM file.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">samtools</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="n">tophat</span><span class="o">/</span><span class="n">ZV9_6h</span><span class="o">/</span><span class="n">accepted_hits</span><span class="o">.</span><span class="n">bam</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">tophat</span><span class="o">/</span><span class="n">ZV9_6h</span><span class="o">/</span><span class="n">accepted_hits</span><span class="o">.</span><span class="n">sorted</span><span class="o">.</span><span class="n">bam</span>
<span class="n">samtools</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="n">tophat</span><span class="o">/</span><span class="n">ZV9_6h</span><span class="o">/</span><span class="n">accepted_hits</span><span class="o">.</span><span class="n">sorted</span><span class="o">.</span><span class="n">bam</span>
</code></pre></div></td></tr></table></div>

<p>Load the sorted BAM file into IGV, as described previously, and rename
the track appropriately.</p>
<h3 id="generating-gene-counts">Generating Gene Counts<a class="headerlink" href="#generating-gene-counts" title="Permanent link">&para;</a></h3>
<p>In RNA-seq experiments the digital gene expression is recorded as the
gene counts or number of reads aligning to a known gene feature. If you
have a well annotated genome, you can use the gene structure file in a
standard gene annotation format (GTF or GFF)) along with the spliced
alignment file to quantify the known genes. We will demonstrate a
utility called <code>FeatureCounts</code> that comes with the <code>Subread</code> package.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>mkdir gene_counts
featureCounts -a annotation/Danio_rerio.Zv9.66.gtf -t exon -g gene_id -o gene_counts/gene_counts.txt tophat/ZV9_6h/accepted_hits.sorted.bam tophat/ZV9_2cells/accepted_hits.sorted.bam
</code></pre></div></td></tr></table></div>

<h2 id="isoform-expression-and-transcriptome-assembly">Isoform Expression and Transcriptome Assembly<a class="headerlink" href="#isoform-expression-and-transcriptome-assembly" title="Permanent link">&para;</a></h2>
<p>For non-model organisms and genomes with draft assemblies and incomplete
annotations, it is a common practice to take an assembly based approach
to generate gene structures followed by the quantification step. There
are a number of reference based transcript assemblers available that can
be used for this purpose such as, cufflinks and stringy. These assemblers
can give gene or isoform level assemblies that can be used to perform a
gene/isoform level quantification. These assemblers require an alignment
of reads with a reference genome or transcriptome as an input. The
second optional input is a known gene structure in <code>GTF</code> or <code>GFF</code>
format.</p>
<p>There are a number of tools that perform reconstruction of the
transcriptome and for this workshop we are going to use Cufflinks.
Cufflinks can do transcriptome assembly either <code>ab initio</code> or using a
reference annotation. It also quantifies the isoform expression in
Fragments Per Kilobase of exon per Million fragments mapped (FPKM).</p>
<p>Cufflinks has a number of parameters in order to perform transcriptome
assembly and quantification. To view them all type:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>cufflinks --help
</code></pre></div></td></tr></table></div>

<p>We aim to reconstruct the transcriptome for both samples by using the
Ensembl annotation both strictly and as a guide. In the first case
Cufflinks will only report isoforms that are included in the annotation,
while in the latter case it will report novel isoforms as well.</p>
<p>The Ensembl annotation for <code>Danio rerio</code> is available in
<code>annotation/Danio_rerio.Zv9.66.gtf</code>.</p>
<p>The general format of the <code>cufflinks</code> command is:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">cufflinks</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]*</span><span class="w"> </span><span class="o">&lt;</span><span class="n">aligned_reads</span><span class="p">.(</span><span class="n">sam</span><span class="o">|</span><span class="n">bam</span><span class="p">)</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>

<p>Where the input is the aligned reads (either in SAM or BAM format).</p>
<p>Some of the available parameters for Cufflinks that we are going to use
to run Cufflinks are listed below:</p>
<p>-o
:   Output directory.</p>
<p>-G
:   Tells Cufflinks to use the supplied GTF annotations strictly in
    order to estimate isoform annotation.</p>
<p>-b
:   Instructs Cufflinks to run a bias detection and correction algorithm
    which can significantly improve accuracy of transcript abundance
    estimates. To do this Cufflinks requires a multi-fasta file with the
    genomic sequences against which we have aligned the reads.</p>
<p>-u
:   Tells Cufflinks to do an initial estimation procedure to more
    accurately weight reads mapping to multiple locations in the genome
    (multi-hits).</p>
<p>–library-type
:   Before performing any type of RNA-seq analysis you need to know a
    few things about the library preparation. Was it done using a
    strand-specific protocol or not? If yes, which strand? In our data
    the protocol was NOT strand specific.</p>
<p>Perform transcriptome assembly, strictly using the supplied GTF
annotations, for the <code>2cells</code> and <code>6h</code> data using cufflinks:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code># 2cells data (takes approx. 5mins):
cufflinks -o cufflinks/ZV9_2cells_gtf -G annotation/Danio_rerio.Zv9.66.gtf -b genome/Danio_rerio.Zv9.66.dna.fa -u --library-type fr-unstranded tophat/ZV9_2cells/accepted_hits.bam
# 6h data (takes approx. 5mins):
cufflinks -o cufflinks/ZV9_6h_gtf -G annotation/Danio_rerio.Zv9.66.gtf -b genome/Danio_rerio.Zv9.66.dna.fa -u --library-type fr-unstranded tophat/ZV9_6h/accepted_hits.bam
</code></pre></div></td></tr></table></div>

<p>Cufflinks generates several files in the specified output directory.
Here’s a short description of these files:</p>
<p>genes.fpkm_tracking
:   Contains the estimated gene-level expression values.</p>
<p>isoforms.fpkm_tracking
:   Contains the estimated isoform-level expression values.</p>
<p>skipped.gtf
:   Contains loci skipped as a result of exceeding the maximum number of
    fragments.</p>
<p>transcripts.gtf
:   This GTF file contains Cufflinks’ assembled isoforms.</p>
<p>The complete documentation can be found at:</p>
<p><a href="http://cole-trapnell-lab.github.io/cufflinks/file_formats/#output-formats-used-in-the-cufflinks-suite">http://cole-trapnell-lab.github.io/cufflinks/file_formats/#output-formats-used-in-the-cufflinks-suite</a></p>
<p>So far we have forced cufflinks, by using the <code>-G</code> option, to strictly
use the GTF annotations provided and thus novel transcripts will not be
reported. We can get cufflinks to perform a GTF-guided transcriptome
assembly by using the <code>-g</code> option instead. Thus, novel transcripts will
be reported.</p>
<p>GTF-guided transcriptome assembly is more computationally intensive than
strictly using the GTF annotations. Therefore, we have pre-computed
these GTF-guided assemblies for you and have placed the results under
subdirectories:</p>
<p><code>cufflinks/ZV9_2cells_gtf_guided</code> and <code>cufflinks/ZV9_6h_gft_guided</code>.</p>
<p>You DO NOT need to run these commands. We provide them so you know how
we generated the the GTF-guided transcriptome assemblies:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code># 2cells guided transcriptome assembly (takes approx. 30mins):
cufflinks -o cufflinks/ZV9_2cells_gtf_guided -g annotation/Danio_rerio.Zv9.66.gtf -b genome/Danio_rerio.Zv9.66.dna.fa -u --library-type fr-unstranded tophat/ZV9_2cells/accepted_hits.bam
# 6h guided transcriptome assembly (takes approx. 30mins):
cufflinks -o cufflinks/ZV9_6h_gtf_guided -g annotation/Danio_rerio.Zv9.66.gtf -b genome/Danio_rerio.Zv9.66.dna.fa -u --library-type fr-unstranded tophat/ZV9_6h/accepted_hits.bam
</code></pre></div></td></tr></table></div>

<ol>
<li>
<p>Go back to IGV and load the pre-computed, GTF-guided transcriptome
    assembly for the <code>2cells</code> data
    (<code>cufflinks/ZV9_2cells_gtf_guided/transcripts.gtf</code>).</p>
</li>
<li>
<p>Rename the track as “2cells GTF-Guided Transcripts”.</p>
</li>
<li>
<p>In the search box type <code>ENSDART00000082297</code> in order for the browser
    to zoom in to the gene of interest.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Do you observe any difference between the Ensembl GTF annotations and the GTF-guided transcripts 
assembled by cufflinks (the “2cells GTF-Guided Transcripts” track)?</p>
</div>
<div class="admonition success">
<details>
<summary><strong>Answer</strong></summary>
<p>Yes. It appears that the Ensembl annotations may have truncated the last exon. 
However, our data also doesn’t contain reads that span between the last two exons.</p>
</details>
</div>
<h2 id="differential-gene-expression-analysis-using-edger">Differential Gene Expression Analysis using edgeR<a class="headerlink" href="#differential-gene-expression-analysis-using-edger" title="Permanent link">&para;</a></h2>
<h3 id="experiment-design">Experiment Design<a class="headerlink" href="#experiment-design" title="Permanent link">&para;</a></h3>
<p>The example we are working through today follows a case Study set out in
the edgeR Users Guide (4.3 Androgen-treated prostate cancer cells
(RNA-Seq, two groups)) which is based on an experiment conducted by Li et
al. (2008, Proc Natl Acad Sci USA, 105, 20179-84).</p>
<p>The researchers used a prostate cancer cell line (LNCaP cells). These
cells are sensitive to stimulation by male hormones (androgens). Three
replicate RNA samples were collected from LNCaP cells treated with an
androgen hormone (DHT). Four replicates were collected from cells
treated with an inactive compound. Each of the seven samples was run on
a lane (7 lanes) of an Illumina flow cell to produce 35 bp reads. The
experimental design was therefore 4 control samples vs 3 treated samples.</p>
<p>This workflow requires raw gene count files and these can be generated
using a utility called featureCounts as demonstrated above. We are using
a pre-computed gene counts data (stored in <code>pnas_expression.txt</code>) for
this exercise.</p>
<h3 id="prepare-the-environment_1">Prepare the Environment<a class="headerlink" href="#prepare-the-environment_1" title="Permanent link">&para;</a></h3>
<p>Prepare the environment and load R:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>cd /home/trainee/rnaseq/edgeR
R (press enter)
</code></pre></div></td></tr></table></div>

<p>Once on the R prompt. Load libraries:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>library(edgeR)
library(biomaRt)
library(gplots)
library(limma)
library(RColorBrewer)
library(org.Hs.eg.db)
</code></pre></div></td></tr></table></div>

<h3 id="read-in-data">Read in Data<a class="headerlink" href="#read-in-data" title="Permanent link">&para;</a></h3>
<p>Read in count table and experimental design:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.delim</span><span class="p">(</span><span class="s">&quot;pnas_expression.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="n">targets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.delim</span><span class="p">(</span><span class="s">&quot;Targets.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">targets</span><span class="o">$</span><span class="n">Label</span>
<span class="nf">head</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">20</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<h3 id="add-gene-annotation">Add Gene annotation<a class="headerlink" href="#add-gene-annotation" title="Permanent link">&para;</a></h3>
<p>The data set only includes the Ensembl gene id and the counts. It is
useful to have other annotations such as the gene symbol and entrez id.
Next we will add in these annotations. We will use the BiomaRt package
to do this.</p>
<p>We start by using the useMart function of BiomaRt to access the human
data base of ensemble gene ids.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">human</span><span class="o">&lt;-</span><span class="nf">useMart</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&quot;www.ensembl.org&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ENSEMBL_MART_ENSEMBL&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dataset</span><span class="o">=</span><span class="s">&quot;hsapiens_gene_ensembl&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="n">attributes</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;ensembl_gene_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;entrezgene&quot;</span><span class="p">,</span><span class="s">&quot;hgnc_symbol&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>We create a vector of our ensemble gene ids.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">ensembl_names</span><span class="o">&lt;-</span><span class="nf">rownames</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">ensembl_names</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>We then use the function getBM to get the gene symbol data we want.This
takes about a minute.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">genemap</span><span class="o">&lt;-</span><span class="nf">getBM</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span><span class="w"> </span><span class="n">filters</span><span class="o">=</span><span class="s">&quot;ensembl_gene_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="o">=</span><span class="n">ensembl_names</span><span class="p">,</span><span class="w"> </span><span class="n">mart</span><span class="o">=</span><span class="n">human</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>Have a look at the start of the genemap dataframe.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>head(genemap)
</code></pre></div></td></tr></table></div>

<p>We then match the data we have retrieved to our dataset.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">match</span><span class="p">(</span><span class="n">ensembl_names</span><span class="p">,</span><span class="w"> </span><span class="n">genemap</span><span class="o">$</span><span class="n">ensembl_gene_id</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">entrezgene</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">genemap</span><span class="o">$</span><span class="n">entrezgene</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="p">]</span>
<span class="n">data</span><span class="o">$</span><span class="n">hgnc_symbol</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">genemap</span><span class="o">$</span><span class="n">hgnc_symbol</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="p">]</span>
<span class="n">Ann</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind</span><span class="p">(</span><span class="nf">rownames</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">hgnc_symbol</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">entrezgene</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">Ann</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Ensembl&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Symbol&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Entrez&quot;</span><span class="p">)</span>
<span class="n">Ann</span><span class="o">&lt;-</span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">Ann</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>Let’s check and see that this additional information is there.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>head(data)
</code></pre></div></td></tr></table></div>

<h3 id="data-checks">Data checks<a class="headerlink" href="#data-checks" title="Permanent link">&para;</a></h3>
<p>Create DGEList object:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">treatment</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;Control&quot;</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;DHT&quot;</span><span class="p">,</span><span class="m">3</span><span class="p">)),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DHT&quot;</span><span class="p">))</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">DGEList</span><span class="p">(</span><span class="n">counts</span><span class="o">=</span><span class="n">data</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">],</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">treatment</span><span class="p">,</span><span class="w"> </span><span class="n">genes</span><span class="o">=</span><span class="n">Ann</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>Check the dimensions of the object:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>dim(y)
</code></pre></div></td></tr></table></div>

<p>We see we have 37435 rows (i.e. genes) and 7 columns (samples).</p>
<p>Now we will filter out genes with low counts by only keeping those rows
where the count per million (cpm) is at least 1 in at least three
samples:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">keep</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">rowSums</span><span class="p">(</span><span class="w"> </span><span class="nf">cpm</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">&gt;</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="m">3</span>
<span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">keep</span><span class="p">,</span><span class="w"> </span><span class="p">]</span>
</code></pre></div></td></tr></table></div>

<p>Check how many rows (genes) are retained now.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>dim(y)
</code></pre></div></td></tr></table></div>

<p>This gives you 16494 rows indicating that 20941 (37435-16494) genes were filtered out.</p>
<p>As we have removed the lowly expressed genes the total number of counts
per sample has not changed greatly. Let us check the total number of
reads per sample in the original data (data) and now after filtering.</p>
<p>Before:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>colSums(data[,1:7])
</code></pre></div></td></tr></table></div>

<p>After filtering:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>colSums(y$counts)
</code></pre></div></td></tr></table></div>

<p>We will now perform normalization to take account of different library
size:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">y</span><span class="o">&lt;-</span><span class="nf">calcNormFactors</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>We will check the calculated normalization factors:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>y$samples
</code></pre></div></td></tr></table></div>

<p>Lets have a look at whether the samples cluster by condition. (You
should produce a plot as shown in Figure 4):</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>plotMDS(y, col=as.numeric(y$samples$group))
</code></pre></div></td></tr></table></div>

<p>[H] <img alt="image" src="../images/MDS.png" /> [fig:MDS plot]</p>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Does the MDS plot indicate a difference in gene expression between the Controls and the DHT treated samples?</p>
</div>
<div class="admonition success">
<details>
<summary><strong>Answer</strong></summary>
<p>The MDS plot shows us that the controls are separated from the DHT treated cells. This indicates that there is a difference in gene expression between the conditions.</p>
</details>
</div>
<p>We will now estimate the dispersion. We start by estimating the common
dispersion. The common dispersion estimates the overall Biological
Coefficient of Variation (BCV) of the dataset averaged over all genes.</p>
<p>By using verbose we get the Disp and BCV values printed on the screen</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">estimateCommonDisp</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>What value to you see for BCV?</p>
<p>We now estimate gene-specific dispersion.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">estimateTagwiseDisp</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>We will plot the tagwise dispersion and the common dispersion (You
should obtain a plot as shown in the Figure 5):</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>plotBCV(y)
</code></pre></div></td></tr></table></div>

<p>[H] <img alt="image" src="../images/BCV.png" /> [fig:BCV plot]</p>
<p>We see here that the common dispersion estimates the overall Biological
Coefficient of Variation (BCV) of the dataset averaged over all genes.
The common dispersion is <code>0.02</code> and the BCV is the square root of the
common dispersion (sqrt[0.02] = 0.14). A BCV of 14% is typical for cell
line experiment.</p>
<p>As you can see from the plot the BCV of some genes (generally those with
low expression) can be much higher than the common dispersion. For
example we see genes with a reasonable level of expression with tagwise
dispersion of 0.4 indicating 40% variation between samples.</p>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>If we used the common dispersion for these genes instead of the tagwise dispersion what effect would this have?</p>
</div>
<div class="admonition success">
<details>
<summary><strong>Answer</strong></summary>
<p>If we simply used the common dispersion for these genes we would underestimate biological variability, which in turn affects whether these genes would be identified as being differentially expressed between conditions. </p>
</details>
</div>
<p>It is recommended to use the tagwise dispersion,which takes account of gene-to-gene variability.</p>
<p>Now that we have normalized our data and also calculated the variability
of gene expression between samples we are in a position to perform
differential expression testing.As this is a simple comparison between
two conditions, androgen treatment and placebo treatment we can use the
exact test for the negative binomial distribution (Robinson and Smyth,
2008).</p>
<h3 id="testing-for-differential-expression">Testing for Differential Expression<a class="headerlink" href="#testing-for-differential-expression" title="Permanent link">&para;</a></h3>
<p>We now test for differentially expressed BCV genes:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">et</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">exactTest</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>Now we will use the topTags function to adjust for multiple testing. We
will use the Benjimini Hochberg (&ldquo;BH&rdquo;) method and we will produce a
table of results:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">topTags</span><span class="p">(</span><span class="n">et</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="nf">nrow</span><span class="p">(</span><span class="n">y</span><span class="o">$</span><span class="n">counts</span><span class="p">),</span><span class="w"> </span><span class="n">adjust.method</span><span class="o">=</span><span class="s">&quot;BH&quot;</span><span class="p">)</span><span class="o">$</span><span class="n">table</span>
</code></pre></div></td></tr></table></div>

<p>Let’s have a look at the first rows of the table:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>head(res)
</code></pre></div></td></tr></table></div>

<p>To get a summary of the number of differentially expressed genes we can
use the decideTestsDGE function.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nf">summary</span><span class="p">(</span><span class="n">de</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">decideTestsDGE</span><span class="p">(</span><span class="n">et</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>

<p>This tells us that 2086 genes are downregulated and 2345 genes are
upregulated at 5% FDR.We will now make subsets of the most significant
upregulated and downregulated genes using a log fold change threshhold of 1.5.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">alpha</span><span class="o">=</span><span class="m">0.05</span>
<span class="n">lfc</span><span class="o">=</span><span class="m">1.5</span>
<span class="n">edgeR_res_sig</span><span class="o">&lt;-</span><span class="n">res</span><span class="p">[</span><span class="n">res</span><span class="o">$</span><span class="n">FDR</span><span class="o">&lt;</span><span class="n">alpha</span><span class="p">,]</span>
<span class="n">edgeR_res_sig_lfc</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">edgeR_res_sig</span><span class="p">[</span><span class="nf">abs</span><span class="p">(</span><span class="n">edgeR_res_sig</span><span class="o">$</span><span class="n">logFC</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">lfc</span><span class="p">,]</span>
<span class="nf">head</span><span class="p">(</span><span class="n">edgeR_res_sig</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">20</span><span class="p">)</span>
<span class="nf">nrow</span><span class="p">(</span><span class="n">edgeR_res_sig</span><span class="p">)</span>
<span class="nf">nrow</span><span class="p">(</span><span class="n">edgeR_res_sig_lfc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>We can write out these results to our current directory.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>write.table(edgeR_res_sig , &quot;edgeR_res_sig.txt&quot;, sep=&quot;\t&quot;, col.names=NA, quote=F)
write.table(edgeR_res_sig_lfc , &quot;edgeR_res_sig_lfc.txt&quot;, sep=&quot;\t&quot;, col.names=NA, quote=F)
</code></pre></div></td></tr></table></div>

<div class="admonition note">
<p class="admonition-title">Question</p>
<p>How many differentially expressed genes are are found by edgeR before and after requiring the log fold change of 1.5?</p>
</div>
<div class="admonition success">
<details>
<summary><strong>Answer</strong></summary>
<p>There are 4431 DEGs at an FDR = 0.05 which reduces to 1148 if we require a log fold change of 1.5.</p>
</details>
</div>
<h2 id="differential-expression-using-the-voom-function-and-the-limma-package">Differential expression using the Voom function and the limma package<a class="headerlink" href="#differential-expression-using-the-voom-function-and-the-limma-package" title="Permanent link">&para;</a></h2>
<p>We will now show an alternative approach to differential expression
which uses the <code>limma</code> package.This is based on linear models. The first
step is to create a design matrix. In this case we have a simple design
where we have only one condition (treated vs non-treated). However, you
may be dealing with more complex experimental designs, for example
looking at treatment and other covariates, such as age, gender, batch.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">design</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">model.matrix</span><span class="p">(</span><span class="o">~</span><span class="n">treatment</span><span class="p">)</span>
<span class="n">check</span><span class="w"> </span><span class="n">design</span>
<span class="nf">print</span><span class="p">(</span><span class="n">design</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>We now use voom to transform the data into a form which is appropriate
for linear modelling.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">v</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">voom</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">design</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>Next we will fit linear model to each gene in the dataset using the
function lmFit. Following this we use the function eBayes to test each
gene to find whether foldchange between the conditions being tested is
statistically significant.We filter our results by using the same values
of alpha (0.05) and log fold change (1.5) used previously.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">fit_v</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">lmFit</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">design</span><span class="p">)</span>

<span class="n">fit_v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">eBayes</span><span class="p">(</span><span class="n">fit_v</span><span class="p">)</span>

<span class="n">voom_res</span><span class="o">&lt;-</span><span class="nf">topTable</span><span class="p">(</span><span class="n">fit_v</span><span class="p">,</span><span class="w"> </span><span class="n">coef</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">adjust.method</span><span class="o">=</span><span class="s">&quot;BH&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sort.by</span><span class="o">=</span><span class="s">&quot;P&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="nf">nrow</span><span class="p">(</span><span class="n">y</span><span class="o">$</span><span class="n">counts</span><span class="p">))</span>

<span class="n">voom_res_sig</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">voom_res</span><span class="p">[</span><span class="n">voom_res</span><span class="o">$</span><span class="n">adj.P.Val</span><span class="w"> </span><span class="o">&lt;</span><span class="n">alpha</span><span class="p">,]</span>

<span class="n">voom_res_sig_lfc</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">voom_res_sig</span><span class="p">[</span><span class="nf">abs</span><span class="p">(</span><span class="n">voom_res_sig</span><span class="o">$</span><span class="n">logFC</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">lfc</span><span class="p">,]</span>
</code></pre></div></td></tr></table></div>

<p>How many differentially expressed genes are identified?</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>nrow(voom_res_sig)
nrow(voom_res_sig_lfc)
</code></pre></div></td></tr></table></div>

<div class="admonition note">
<p class="admonition-title">Question</p>
<p>How many differentially expressed genes are found using voom before and after requiring the log fold change of 1.5?</p>
</div>
<div class="admonition success">
<details>
<summary><strong>Answer</strong></summary>
<p>There are 4103 DEGs at an FDR = 0.05 which reduces to 1109 if we require a log fold change of 1.5.</p>
</details>
</div>
<p>We will write out these results.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>write.table(voom_res_sig, &quot;voom_res_sig.txt&quot;, sep=&quot;\t&quot;, col.names=NA, quote=F)
write.table(voom_res_sig_lfc, &quot;voom_res_sig_lfc.txt&quot;, sep=&quot;\t&quot;, col.names=NA, quote=F)
write.table(voom_res, &quot;voom_res.txt&quot;, sep=&quot;\t&quot;, col.names=NA, quote=F)
</code></pre></div></td></tr></table></div>

<h2 id="data-visualisation">Data Visualisation<a class="headerlink" href="#data-visualisation" title="Permanent link">&para;</a></h2>
<p>Now let’s visualize some of this data. First we will make a volcano plot
using the <code>volcanoplot</code> function available in <code>limma</code>. This creates a
plot which displays fold changes versus a measure of statistical
significance of the change.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>volcanoplot(fit_v, coef=2, highlight=5)
</code></pre></div></td></tr></table></div>

<p>[H] <img alt="image" src="../images/Volcano.png" /> [fig:Volcano plot]</p>
<p>Next we will create a heatmap of the top differentially expressed genes.
We use the heatmap.2 function available in the gplots package.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">select_top</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">p.adjust</span><span class="p">(</span><span class="n">fit_v</span><span class="o">$</span><span class="n">p.value</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w"> </span><span class="o">&lt;</span><span class="m">1e-2</span>
<span class="n">Exp_top</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">v</span><span class="o">$</span><span class="n">E</span><span class="w"> </span><span class="p">[</span><span class="n">select_top</span><span class="p">,</span><span class="w"> </span><span class="p">]</span>
<span class="nf">heatmap.2</span><span class="p">(</span><span class="n">Exp_top</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">density.info</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">trace</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;Top DEGs&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">labRow</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cexRow</span><span class="o">=</span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="n">cexCol</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>[H] <img alt="image" src="../images/Heatmap.png" /> [fig:Heatmap]</p>
<p>You can now quit the R prompt</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>q()
</code></pre></div></td></tr></table></div>

<p>You can save your workspace by typing <code>Y</code> on prompt.</p>
<p>Please note that the output files you are creating are saved in your
present working directory. If you are not sure where you are in the file
system try typing <code>pwd</code> on your command prompt to find out.</p>
<h2 id="differential-expression-using-cuffdiff">Differential Expression using cuffdiff<a class="headerlink" href="#differential-expression-using-cuffdiff" title="Permanent link">&para;</a></h2>
<p>This is optional exercise and will be run if time permits.</p>
<p>NOTE: If this exercise is to be attempted it is necessary to leave the directory we have been working in and go back to the zebra fish data. Commands should be executed from the rnaseq directory.</p>
<p>One of the stand-alone tools that perform differential expression
analysis is Cuffdiff. We use this tool to compare between two
conditions; for example different conditions could be control and
disease, or wild-type and mutant, or various developmental stages.</p>
<p>In our case we want to identify genes that are differentially expressed
between two developmental stages; a <code>2cells</code> embryo and <code>6h</code> post
fertilization.</p>
<p>The general format of the cuffdiff command is:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">cuffdiff</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]*</span><span class="w"> </span><span class="o">&lt;</span><span class="n">transcripts</span><span class="p">.</span><span class="n">gtf</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">sample1_replicate1</span><span class="p">.</span><span class="n">sam</span><span class="o">[</span><span class="n">,...,sample1_replicateM</span><span class="o">]&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">sample2_replicate1</span><span class="p">.</span><span class="n">sam</span><span class="o">[</span><span class="n">,...,sample2_replicateM.sam</span><span class="o">]&gt;</span>
</code></pre></div></td></tr></table></div>

<p>Where the input includes a <code>transcripts.gtf</code> file, which is an
annotation file of the genome of interest or the cufflinks assembled
transcripts, and the aligned reads (either in SAM or BAM format) for the
conditions. Some of the Cufflinks options that we will use to run the
program are:</p>
<p>-o
:   Output directory.</p>
<p>-L
:   Labels for the different conditions</p>
<p>-T
:   Tells Cuffdiff that the reads are from a time series experiment.</p>
<p>-b
:   Instructs Cufflinks to run a bias detection and correction algorithm
    which can significantly improve accuracy of transcript abundance
    estimates. To do this Cufflinks requires a multi-fasta file with the
    genomic sequences against which we have aligned the reads.</p>
<p>-u
:   Tells Cufflinks to do an initial estimation procedure to more
    accurately weight reads mapping to multiple locations in the genome
    (multi-hits).</p>
<p>–library-type
:   Before performing any type of RNA-seq analysis you need to know a
    few things about the library preparation. Was it done using a
    strand-specific protocol or not? If yes, which strand? In our data
    the protocol was NOT strand specific.</p>
<p>-C
:   Biological replicates and multiple group contrast can be defined
    here</p>
<p>Run cuffdiff on the tophat generated BAM files for the 2cells vs. 6h
data sets:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>cuffdiff -o cuffdiff/ -L ZV9_2cells,ZV9_6h -T -b genome/Danio_rerio.Zv9.66.dna.fa -u --library-type fr-unstranded annotation/Danio_rerio.Zv9.66.gtf tophat/ZV9_2cells/accepted_hits.bam tophat/ZV9_6h/accepted_hits.bam
</code></pre></div></td></tr></table></div>

<p>We are interested in the differential expression at the gene level. The
results are reported by Cuffdiff in the file <code>cuffdiff/gene_exp.diff</code>.
Look at the first few lines of the file using the following command:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>head -n 20 cuffdiff/gene_exp.diff
</code></pre></div></td></tr></table></div>

<p>We would like to see which are the most significantly differentially
expressed genes. Therefore we will sort the above file according to the
q value (corrected p value for multiple testing). The result will be
stored in a different file called <code>gene_exp_qval.sorted.diff</code>.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>sort -t$&#39;\t&#39; -g -k 13 cuffdiff/gene_exp.diff &gt; cuffdiff/gene_exp_qval.sorted.diff
</code></pre></div></td></tr></table></div>

<p>Look again at the top 20 lines of the sorted file by typing:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>head -n 20 cuffdiff/gene_exp_qval.sorted.diff
</code></pre></div></td></tr></table></div>

<p>Copy an Ensembl transcript identifier from the first two columns for one
of these genes (e.g. <code>ENSDARG00000045067</code>). Now go back to the IGV
browser and paste it in the search box.</p>
<p>What are the various outputs generated by cuffdiff? Hint: Please refer
to the <code>Cuffdiff output</code> section of the cufflinks manual online.</p>
<p>Do you see any difference in the read coverage between the <code>2cells</code> and
<code>6h</code> conditions that might have given rise to this transcript being
called as differentially expressed?</p>
<p>The coverage on the Ensembl browser is based on raw reads and no
normalisation has taken place contrary to the FPKM values.</p>
<p>The read coverage of this transcript (<code>ENSDARG00000045067</code>) in the 6h
data set is much higher than in the 2cells data set.</p>
<h2 id="visualising-the-cuffdiff-expression-analysis">Visualising the CuffDiff expression analysis<a class="headerlink" href="#visualising-the-cuffdiff-expression-analysis" title="Permanent link">&para;</a></h2>
<p>We will use an R-Bioconductor package called <code>cummeRbund</code> to visualise,
manipulate and explore Cufflinks RNA-seq output. We will load an R
environment and look at few quick tips to generate simple graphical
output of the cufflinks analysis we have just run.</p>
<p><code>CummeRbund</code> takes the cuffdiff output and populates a SQLite database
with various type of output generated by cuffdiff e.g, genes,
transcripts, transcription start site, isoforms and CDS regions. The
data from this database can be accessed and processed easily. This
package comes with a number of in-built plotting functions that are
commonly used for visualising the expression data. We strongly recommend
reading through the bioconductor manual and user guide of CummeRbund to
learn about functionality of the tool. The reference is provided in the
resource section.</p>
<p>Prepare the environment. Go to the <code>cuffdiff</code> output folder and copy the
transcripts file there.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>cd /home/trainee/rnaseq/cuffdiff
cp /home/trainee/rnaseq/annotation/Danio_rerio.Zv9.66.gtf /home/trainee/rnaseq/cuffdiff
ls -l
</code></pre></div></td></tr></table></div>

<p>Load the R environment</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>R (press enter)
</code></pre></div></td></tr></table></div>

<p>Load the require R package.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>library(cummeRbund)
</code></pre></div></td></tr></table></div>

<p>Read in the cuffdiff output</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">cuff</span><span class="o">&lt;-</span><span class="nf">readCufflinks</span><span class="p">(</span><span class="n">dir</span><span class="o">=</span><span class="s">&quot;/home/trainee/rnaseq/cuffdiff”, gtfFile=&#39;Danio_rerio.Zv9.66.gtf&#39;,genome=&quot;</span><span class="n">Zv9</span><span class="s">&quot;</span><span class="err">, rebuild=T)</span>
</code></pre></div></td></tr></table></div>

<p>Assess the distribution of FPKM scores across samples</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SCV.pdf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">)</span>
<span class="n">dens</span><span class="o">&lt;-</span><span class="nf">csDensity</span><span class="p">(</span><span class="nf">genes</span><span class="p">(</span><span class="n">cuff</span><span class="p">))</span>
<span class="n">dens</span>
<span class="nf">dev.off</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>

<p>Box plots of the FPKM values for each samples</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BoxP.pdf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">)</span>
<span class="n">b</span><span class="o">&lt;-</span><span class="nf">csBoxplot</span><span class="p">(</span><span class="nf">genes</span><span class="p">(</span><span class="n">cuff</span><span class="p">))</span>
<span class="n">b</span>
<span class="nf">dev.off</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>

<p>Accessing the data</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">sigGeneIds</span><span class="o">&lt;-</span><span class="nf">getSig</span><span class="p">(</span><span class="n">cuff</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.05</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="s">&quot;genes&quot;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">sigGeneIds</span><span class="p">)</span>
<span class="n">sigGenes</span><span class="o">&lt;-</span><span class="nf">getGenes</span><span class="p">(</span><span class="n">cuff</span><span class="p">,</span><span class="n">sigGeneIds</span><span class="p">)</span>
<span class="n">sigGenes</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">fpkm</span><span class="p">(</span><span class="n">sigGenes</span><span class="p">))</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">fpkm</span><span class="p">(</span><span class="nf">isoforms</span><span class="p">(</span><span class="n">sigGenes</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>

<p>Plotting a heatmap of the differentially expressed genes</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nf">pdf</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;heatmap.pdf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">)</span>
<span class="n">h</span><span class="o">&lt;-</span><span class="nf">csHeatmap</span><span class="p">(</span><span class="n">sigGenes</span><span class="p">,</span><span class="n">cluster</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>
<span class="n">h</span>
<span class="nf">dev.off</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>

<p>What options would you use to draw a density or boxplot for different
replicates if available ? (Hint: look at the manual at Bioconductor
website)</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">densRep</span><span class="o">&lt;-</span><span class="nf">csDensity</span><span class="p">(</span><span class="nf">genes</span><span class="p">(</span><span class="n">cuff</span><span class="p">),</span><span class="n">replicates</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="n">brep</span><span class="o">&lt;-</span><span class="nf">csBoxplot</span><span class="p">(</span><span class="nf">genes</span><span class="p">(</span><span class="n">cuff</span><span class="p">),</span><span class="n">replicates</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

<p>How many differentially expressed genes did you observe?</p>
<p>type ’summary(sigGenes)’ on the R prompt to see.</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Trapnell, C., Pachter, L. &amp; Salzberg, S. L. TopHat: discovering
    splice junctions with RNA-Seq. Bioinformatics 25, 1105-1111 (2009).</p>
</li>
<li>
<p>Trapnell, C. et al. Transcript assembly and quantification by
    RNA-Seq reveals unannotated transcripts and isoform switching during
    cell differentiation. Nat. Biotechnol. 28, 511-515 (2010).</p>
</li>
<li>
<p>Langmead, B., Trapnell, C., Pop, M. &amp; Salzberg, S. L. Ultrafast and
    memory-efficient alignment of short DNA sequences to the human
    genome. Genome Biol. 10, R25 (2009).</p>
</li>
<li>
<p>Roberts, A., Pimentel, H., Trapnell, C. &amp; Pachter, L. Identification
    of novel transcripts in annotated genomes using RNA-Seq.
    Bioinformatics 27, 2325-2329 (2011).</p>
</li>
<li>
<p>Roberts, A., Trapnell, C., Donaghey, J., Rinn, J. L. &amp; Pachter, L.
    Improving RNA-Seq expression estimates by correcting for fragment
    bias. Genome Biol. 12, R22 (2011).</p>
</li>
<li>
<p>Robinson MD, McCarthy DJ and Smyth GK. edgeR: a Bioconductor package
    for differential expression analysis of digital gene expression
    data. Bioinformatics, 26 (2010).</p>
</li>
<li>
<p>Robinson MD and Smyth GK Moderated statistical tests for assessing
    differences in tag abundance. Bioinformatics, 23, pp. -6.</p>
</li>
<li>
<p>Robinson MD and Smyth GK (2008). Small-sample estimation of negative
    binomial dispersion, with applications to SAGE data.” Biostatistics,
    9.</p>
</li>
<li>
<p>McCarthy, J. D, Chen, Yunshun, Smyth and K. G (2012). Differential
    expression analysis of multifactor RNA-Seq experiments with respect
    to biological variation. Nucleic Acids Research, 40(10), pp. -9.</p>
</li>
</ol>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; The authors; 2017-
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.12658920.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.5cf534bf.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../../js/details.js"></script>
      
    
  </body>
</html>