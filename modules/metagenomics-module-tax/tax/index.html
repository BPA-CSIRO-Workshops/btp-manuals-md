
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This contains all material for Markdown version of BTP workshops.">
      
      
        <meta name="author" content="Authors">
      
      
      
        <link rel="prev" href="../../metagenomics-module-qc/ngs-qc/">
      
      
        <link rel="next" href="../../metagenomics-module-vis/vis/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.2">
    
    
      
        <title>Metagenomics Taxonomic - Markdown Manuals for Bioinformatics Training Platform (BTP)</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.f56500e0.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/details.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#an-introduction-to-taxonomic-analysis-of-amplicon-and-shotgun-data-using-qiime" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Markdown Manuals for Bioinformatics Training Platform (BTP)" class="md-header__button md-logo" aria-label="Markdown Manuals for Bioinformatics Training Platform (BTP)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Markdown Manuals for Bioinformatics Training Platform (BTP)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Metagenomics Taxonomic
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Markdown Manuals for Bioinformatics Training Platform (BTP)" class="md-nav__button md-logo" aria-label="Markdown Manuals for Bioinformatics Training Platform (BTP)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Markdown Manuals for Bioinformatics Training Platform (BTP)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../trainers/trainers/" class="md-nav__link">
        The Trainers
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Timetable
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Timetable" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Timetable
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../timetables/timetable_introNGS/" class="md-nav__link">
        Intro to NGS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../timetables/timetable_cancer/" class="md-nav__link">
        Cancer Genomics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../timetables/timetable_longRead/" class="md-nav__link">
        Long Read
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../preamble/" class="md-nav__link">
        Workshop Information
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Introduction to NGS Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction to NGS Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Introduction to NGS Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-ngs-cli/commandline/" class="md-nav__link">
        Introduction to Command Line
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-ngs-qc/ngs-qc/" class="md-nav__link">
        Data Quality
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-ngs-mapping/alignment/" class="md-nav__link">
        Read Alignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-chip-seq/chip-seq/" class="md-nav__link">
        ChIP-seq
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-rna-seq/rna-seq/" class="md-nav__link">
        RNA-Seq
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-ngs-bio/biol/" class="md-nav__link">
        NGS Biological Insight
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-velvet/velvet/" class="md-nav__link">
        de novo Genome Assembly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../btp-module-denovo-canu/denovo_canu/" class="md-nav__link">
        DeNovo Canu
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Cancer Genomics Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cancer Genomics Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Cancer Genomics Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-alignment/alignment/" class="md-nav__link">
        Read Alignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-snv/snv/" class="md-nav__link">
        Single Nucleotide Variant Calling and Annotation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-cnv/cnv-tut/" class="md-nav__link">
        Copy Number Variation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-sv/sv_tut/" class="md-nav__link">
        Structural Variant Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-viz/visu/" class="md-nav__link">
        Variant Visualisation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" type="checkbox" id="__nav_6_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_6">
          Somatic Mutations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Somatic Mutations" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_6">
          <span class="md-nav__icon md-icon"></span>
          Somatic Mutations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-somatic/01_signatures/" class="md-nav__link">
        Assessing somatic mutational signatures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cancer-module-somatic/02_intogen/" class="md-nav__link">
        Cohort analysis for the identification of driver genes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          DeNovo Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DeNovo Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          DeNovo Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../denovo-module-bac/bac_asm/" class="md-nav__link">
        Bacterial Assembly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../denovo-module-euk/eukaryotic_assem/" class="md-nav__link">
        Eukaryote Assembly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../denovo-module-scaffolding/scaffold/" class="md-nav__link">
        Scaffolding
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Metagenomics Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metagenomics Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Metagenomics Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metagenomics-module-qc/ngs-qc/" class="md-nav__link">
        Metagenomics QC
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Metagenomics Taxonomic
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Metagenomics Taxonomic
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-learning-outcomes" class="md-nav__link">
    Key Learning Outcomes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-you-will-be-using" class="md-nav__link">
    Resources you will be using
  </a>
  
    <nav class="md-nav" aria-label="Resources you will be using">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tools-used-part-1-16s-analysis" class="md-nav__link">
    Tools Used: Part 1. 16S Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools-used-part-2-16s-analysis-of-whole-genome-shotgun-sequencing" class="md-nav__link">
    Tools Used: Part 2. 16S analysis of whole genome shotgun sequencing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-links" class="md-nav__link">
    Useful Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sources-of-data" class="md-nav__link">
    Sources of Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-1-16s-analysis" class="md-nav__link">
    Part 1: 16S Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2-16s-analysis-of-whole-genome-shotgun-sequencing" class="md-nav__link">
    Part 2: 16S analysis of whole genome shotgun sequencing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-1-16s-analysis_1" class="md-nav__link">
    Part 1: 16S Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#de-novo-otu-picking-and-diversity-analysis-using-illumina-data" class="md-nav__link">
    De novo OTU picking and diversity analysis using Illumina data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-mapping-file" class="md-nav__link">
    The Mapping file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-directory-of-pe-reads" class="md-nav__link">
    Join directory of PE reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtering-reads-by-quality-and-length" class="md-nav__link">
    Filtering reads by quality and length
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conversion-to-fasta-and-removal-of-chimeric-reads" class="md-nav__link">
    Conversion to FASTA and removal of chimeric reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assign-samples-to-the-reads" class="md-nav__link">
    Assign samples to the reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#de-novo-otu-picking" class="md-nav__link">
    De novo OTU picking
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-low-confidence-otus" class="md-nav__link">
    Remove low confidence OTUs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-otu-statistics" class="md-nav__link">
    View OTU statistics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rarify-reads" class="md-nav__link">
    Rarify reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualize-taxonomic-composition" class="md-nav__link">
    Visualize taxonomic composition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alpha-diversity-within-samples-and-rarefaction-curves" class="md-nav__link">
    Alpha diversity within samples and rarefaction curves
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beta-diversity-and-beta-diversity-plots" class="md-nav__link">
    Beta diversity and beta diversity plots
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-for-statistical-differences" class="md-nav__link">
    Testing for statistical differences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unifrac-beta-diversity-analysis" class="md-nav__link">
    UniFrac beta diversity analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-stamp-to-test-for-particular-differences" class="md-nav__link">
    Using STAMP to test for particular differences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2-16s-analysis-of-whole-genome-shotgun-sequencing_1" class="md-nav__link">
    Part 2: 16S analysis of whole genome shotgun sequencing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#closed-reference-otu-picking-of-16s-ribosomal-rrna-fragments-selected-from-a-shotgun-data-set" class="md-nav__link">
    Closed reference OTU picking of 16S ribosomal rRNA fragments selected from a shotgun data set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extraction-of-16s-rrna-sequence-containing-reads-with-rrnaselector" class="md-nav__link">
    Extraction of 16S rRNA sequence-containing reads with rRNASelector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#closed-reference-otu-picking-workflow-and-visualization-of-results-in-megan-6" class="md-nav__link">
    Closed-reference OTU picking workflow and visualization of results in Megan 6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonus" class="md-nav__link">
    Bonus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metagenomics-module-vis/vis/" class="md-nav__link">
        Metagenomics Visualisation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metagenomics-module-wga/wga/" class="md-nav__link">
        Metagenomics WGA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metagenomics-module-fda/fda/" class="md-nav__link">
        Metagenomics Functional Analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-learning-outcomes" class="md-nav__link">
    Key Learning Outcomes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-you-will-be-using" class="md-nav__link">
    Resources you will be using
  </a>
  
    <nav class="md-nav" aria-label="Resources you will be using">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tools-used-part-1-16s-analysis" class="md-nav__link">
    Tools Used: Part 1. 16S Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools-used-part-2-16s-analysis-of-whole-genome-shotgun-sequencing" class="md-nav__link">
    Tools Used: Part 2. 16S analysis of whole genome shotgun sequencing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-links" class="md-nav__link">
    Useful Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sources-of-data" class="md-nav__link">
    Sources of Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-1-16s-analysis" class="md-nav__link">
    Part 1: 16S Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2-16s-analysis-of-whole-genome-shotgun-sequencing" class="md-nav__link">
    Part 2: 16S analysis of whole genome shotgun sequencing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-1-16s-analysis_1" class="md-nav__link">
    Part 1: 16S Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#de-novo-otu-picking-and-diversity-analysis-using-illumina-data" class="md-nav__link">
    De novo OTU picking and diversity analysis using Illumina data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-mapping-file" class="md-nav__link">
    The Mapping file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-directory-of-pe-reads" class="md-nav__link">
    Join directory of PE reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtering-reads-by-quality-and-length" class="md-nav__link">
    Filtering reads by quality and length
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conversion-to-fasta-and-removal-of-chimeric-reads" class="md-nav__link">
    Conversion to FASTA and removal of chimeric reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assign-samples-to-the-reads" class="md-nav__link">
    Assign samples to the reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#de-novo-otu-picking" class="md-nav__link">
    De novo OTU picking
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-low-confidence-otus" class="md-nav__link">
    Remove low confidence OTUs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-otu-statistics" class="md-nav__link">
    View OTU statistics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rarify-reads" class="md-nav__link">
    Rarify reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualize-taxonomic-composition" class="md-nav__link">
    Visualize taxonomic composition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alpha-diversity-within-samples-and-rarefaction-curves" class="md-nav__link">
    Alpha diversity within samples and rarefaction curves
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beta-diversity-and-beta-diversity-plots" class="md-nav__link">
    Beta diversity and beta diversity plots
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-for-statistical-differences" class="md-nav__link">
    Testing for statistical differences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unifrac-beta-diversity-analysis" class="md-nav__link">
    UniFrac beta diversity analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-stamp-to-test-for-particular-differences" class="md-nav__link">
    Using STAMP to test for particular differences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2-16s-analysis-of-whole-genome-shotgun-sequencing_1" class="md-nav__link">
    Part 2: 16S analysis of whole genome shotgun sequencing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#closed-reference-otu-picking-of-16s-ribosomal-rrna-fragments-selected-from-a-shotgun-data-set" class="md-nav__link">
    Closed reference OTU picking of 16S ribosomal rRNA fragments selected from a shotgun data set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extraction-of-16s-rrna-sequence-containing-reads-with-rrnaselector" class="md-nav__link">
    Extraction of 16S rRNA sequence-containing reads with rRNASelector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#closed-reference-otu-picking-workflow-and-visualization-of-results-in-megan-6" class="md-nav__link">
    Closed-reference OTU picking workflow and visualization of results in Megan 6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonus" class="md-nav__link">
    Bonus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="an-introduction-to-taxonomic-analysis-of-amplicon-and-shotgun-data-using-qiime">An introduction to taxonomic analysis of amplicon and shotgun data using QIIME<a class="headerlink" href="#an-introduction-to-taxonomic-analysis-of-amplicon-and-shotgun-data-using-qiime" title="Permanent link">&para;</a></h1>
<h2 id="key-learning-outcomes">Key Learning Outcomes<a class="headerlink" href="#key-learning-outcomes" title="Permanent link">&para;</a></h2>
<hr />
<p>After completing this practical the trainee should be able to:</p>
<ul>
<li>
<p>Understand the open source software package QIIME for analysis</p>
</li>
<li>
<p>Perform a taxonomic analysis on a 16S rRNA amplicon dataset</p>
</li>
<li>
<p>Conduct 16S taxonomic analysis on shotgun data</p>
</li>
</ul>
<h2 id="resources-you-will-be-using">Resources you will be using<a class="headerlink" href="#resources-you-will-be-using" title="Permanent link">&para;</a></h2>
<hr />
<h3 id="tools-used-part-1-16s-analysis">Tools Used: Part 1. 16S Analysis<a class="headerlink" href="#tools-used-part-1-16s-analysis" title="Permanent link">&para;</a></h3>
<p>QIIME :  <a href="http://qiime.org/">http://qiime.org/</a></p>
<p>PEAR: <a href="http://sco.h-its.org/exelixis/web/software/pear/doc.html">http://sco.h-its.org/exelixis/web/software/pear/doc.html</a></p>
<p>FASTX toolkit (v0.0.14): <a href="http://hannonlab.cshl.edu/fastx_toolkit/download.html">http://hannonlab.cshl.edu/fastx_toolkit/download.html</a></p>
<p>BBMap: <a href="http://sourceforge.net/projects/bbmap">http://sourceforge.net/projects/bbmap</a></p>
<p>VSEARCH: <a href="https://github.com/torognes/vsearch">https://github.com/torognes/vsearch</a></p>
<p>SortMeRNA: <a href="http://bioinfo.lifl.fr/RNA/sortmerna/">http://bioinfo.lifl.fr/RNA/sortmerna/</a></p>
<p>STAMP: <a href="http://kiwi.cs.dal.ca/Software/STAMP">http://kiwi.cs.dal.ca/Software/STAMP</a></p>
<h3 id="tools-used-part-2-16s-analysis-of-whole-genome-shotgun-sequencing">Tools Used: Part 2. 16S analysis of whole genome shotgun sequencing<a class="headerlink" href="#tools-used-part-2-16s-analysis-of-whole-genome-shotgun-sequencing" title="Permanent link">&para;</a></h3>
<p>rRNASelector :   <a href="http://www.ezbiocloud.net/sw/rrnaselector">http://www.ezbiocloud.net/sw/rrnaselector</a></p>
<p>MEGAN6 : <a href="http://ab.inf.uni-tuebingen.de/software/megan6">http://ab.inf.uni-tuebingen.de/software/megan6</a></p>
<h3 id="useful-links">Useful Links<a class="headerlink" href="#useful-links" title="Permanent link">&para;</a></h3>
<hr />
<p>FASTQ Encoding:   </p>
<p><a href="http://en.wikipedia.org/wiki/FASTQ_format#Encoding">http://en.wikipedia.org/wiki/FASTQ_format#Encoding</a></p>
<p>QIIME Tutorials:
<a href="http://qiime.org/tutorials/tutorial.html">http://qiime.org/tutorials/tutorial.html</a></p>
<p>16S Tutorials:
<a href="https://github.com/mlangill/microbiome_helper/wiki/16S-tutorial-(chemerin">https://github.com/mlangill/microbiome_helper/wiki/16S-tutorial-(chemerin</a>)</p>
<p>Lee et al. (2011). rRNASelector: a computer program for selecting ribosomal RNA encoding sequences from metagenomic and metatranscriptomic shotgun libraries. J. Microbiol. 49(4):689-691.</p>
<h3 id="sources-of-data">Sources of Data<a class="headerlink" href="#sources-of-data" title="Permanent link">&para;</a></h3>
<hr />
<h3 id="part-1-16s-analysis">Part 1: 16S Analysis<a class="headerlink" href="#part-1-16s-analysis" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Data : Mouse gut microbial composition affected by the protein chemerin.  <a href="https://www.dropbox.com/s/4fqgi6t3so69224/Sinal_Langille_raw_data.tar.gz">https://www.dropbox.com/s/4fqgi6t3so69224/Sinal_Langille_raw_data.tar.gz</a>
<a href="https://www.dropbox.com/s/r2jqqc7brxg4jhx/16S_chemerin_tutorial.zip">https://www.dropbox.com/s/r2jqqc7brxg4jhx/16S_chemerin_tutorial.zip</a></p>
</li>
<li>
<p>RDP_trainset16_022016.fa (20 MB) is a subset of the Ribosome Database Project (RDP) filtered to include only bacteria.
<a href="https://www.dropbox.com/s/qnlsv7ve2lg6qfp/RDP_trainset16_022016.fa?dl=1">https://www.dropbox.com/s/qnlsv7ve2lg6qfp/RDP_trainset16_022016.fa?dl=1</a> </p>
</li>
</ul>
<h3 id="part-2-16s-analysis-of-whole-genome-shotgun-sequencing">Part 2: 16S analysis of whole genome shotgun sequencing<a class="headerlink" href="#part-2-16s-analysis-of-whole-genome-shotgun-sequencing" title="Permanent link">&para;</a></h3>
<ul>
<li>Li et al. (2013). Draft Genome Sequence of Thermoanaerobacter sp. Strain A7A, Reconstructed from a Metagenome Obtained from a High-Temperature Hydrocarbon Reservoir in the Bass Strait, Australia. Genome Announc. 1(5): e00701-13.</li>
</ul>
<h3 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h3>
<hr />
<p>In this tutorial we will look at the open source software package QIIME (pronounced ’chime’). QIIME stands for Quantitative Insights Into Microbial Ecology. The package contains many tools that enable users to analyse and compare microbial communities. </p>
<p>After completion of this tutorial, you should be able to perform a taxonomic analysis on a Illumina pair end 16S rRNA amplicon dataset. In addition you should be able to do 16S rRNA taxonomic analysis on shotgun data using the tool rRNASelector in combination with QIIME and other third party tools.</p>
<h3 id="part-1-16s-analysis_1"><em>Part 1: 16S Analysis</em><a class="headerlink" href="#part-1-16s-analysis_1" title="Permanent link">&para;</a></h3>
<h3 id="de-novo-otu-picking-and-diversity-analysis-using-illumina-data">De novo OTU picking and diversity analysis using Illumina data<a class="headerlink" href="#de-novo-otu-picking-and-diversity-analysis-using-illumina-data" title="Permanent link">&para;</a></h3>
<hr />
<h3 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h3>
<p>The workflow for 16S analysis in general is as follows:</p>
<ol>
<li>Split multiplexed reads to samples</li>
<li>Join overlapping read pairs</li>
<li>Filter reads on quality and length</li>
<li>Filter Chimera sequences</li>
<li>Assign reads to samples</li>
<li>Pick operational taxonomic units (OTUs) for each sample</li>
<li>Alpha diversity analysis and rarefaction</li>
<li>Beta diversity analysis and Taxonomic composition</li>
<li>PCA analysis</li>
</ol>
<p>16S analysis is a method of microbiome analysis (compared to shotgun metagenomics) that targets the 16S ribosomal RNA gene, as this gene is present in all prokaryotes. It features regions that are conserved among these organisms, as well as variable regions that allow distinction among organisms. These characteristics make this gene useful for analyzing microbial communities at reduced cost compared to metagenomic techniques. A similar workflow can be applied to eukaryotic micro-organisms using the 18S rRNA gene.</p>
<p>The tutorial dataset was originally used in a project to determine whether knocking out the protein chemerin affects gut microbial composition. Originally 116 mouse samples acquired from two different facilities were used for this project (only 24 samples were used in this tutorial dataset, for simplicity). </p>
<h3 id="the-mapping-file">The Mapping file<a class="headerlink" href="#the-mapping-file" title="Permanent link">&para;</a></h3>
<p>Metadata associated with each sample is indicated in the mapping file (map.txt). The mapping file associates the read data files for a sample to it&rsquo;s metadata. The mapping file can contain information on your experimental design. The format is very strict; columns are separated with a single TAB character; the header names have to be typed exactly as specified in the documentation. A good sample description is useful as it is used in the legends of the figures QIIME generates.</p>
<p>In the mapping (map.txt) file the genotypes of interest can be seen: wildtype (WT), chemerin knockout (chemerin_KO), chemerin receptor knockout (CMKLR1_KO) and a heterozygote for the receptor knockout (HET). Also of importance are the two source facilities: &ldquo;BZ&rdquo; and &ldquo;CJS&rdquo;. It is important to include as much metadata as possible, so that it can be easily explored later on.</p>
<p>Open Terminal and go to the dataset&rsquo;s directory:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/Desktop/16S_chemerin_tutorial
ls<span class="w"> </span>-lhtr
</code></pre></div>
<p>&ldquo;fastq&rdquo; is the directory containing all the sequencing files, which we are going to process. The file &ldquo;map.txt&rdquo; contains metadata about the samples. We can look at it with the less command (hit &ldquo;q&rdquo; to exit):</p>
<div class="highlight"><pre><span></span><code>less<span class="w"> </span>-S<span class="w"> </span>map.txt
</code></pre></div>
<p>The first column is the sample IDs, the next 2 are blank (note the file is tab-delimited, meaning each column is separated by a tab, not just whitespace) and the 4<sup>th</sup> column contains FASTA filenames (these filenames are based on what we will produce in this pipeline). The rest of the columns are metadata about the samples.</p>
<p>Here is what the first 4 lines should look like:</p>
<div class="highlight"><pre><span></span><code>SampleID       BarcodeSequence LinkerPrimerSequence    FileInput       Source  Mouse#  Cage#   genotype        SamplingWeek
105CHE6WT                       105CHE6WT_S325_L001.assembled_filtered.nonchimera.fasta BZ      BZ25    7       WT      wk6
106CHE6WT                       106CHE6WT_S336_L001.assembled_filtered.nonchimera.fasta BZ      BZ26    7       WT      wk6
107CHE6KO                       107CHE6KO_S347_L001.assembled_filtered.nonchimera.fasta BZ      BZ27    7       chemerin_KO     wk6
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>The Barcode and LinkerPrimerSequence are absent for this tutorial, these would be used for assigning multiplexed reads to samples and for quality control. Our tutorial data set is already de-multiplexed. What QIIME could be used? </p>
<p>Execute the following command and test the mapping file for potential errors:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>validate_mapping_file.py -m map.txt -o map_output
</code></pre></div></td></tr></table></div>

<p>There shouldn’t be any errors, but if errors occur a corrected mapping file will be written to the directory map_output</p>
<h3 id="join-directory-of-pe-reads">Join directory of PE reads<a class="headerlink" href="#join-directory-of-pe-reads" title="Permanent link">&para;</a></h3>
<p>First we need to join the overlapping Illumina Pair End (PE) reads contained in the fastq directory for each sample.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>cd ~/Desktop/16S_chemerin_tutorial  
run_pear.pl -p 4 -o stitched_reads fastq/*fastq
</code></pre></div></td></tr></table></div>

<div class="highlight"><pre><span></span><code>&quot;-p 4&quot; indicates this job should be run on 4 CPU 
&quot;-o stitched_reads&quot; indicates that the output folder)
</code></pre></div>
<p>Four FASTQ files will be generated for each set of paired-end reads:
    (1) assembled reads (used for downstream analyses)
    (2) discarded reads (often abnormal reads, e.g. large run of Ns).
    (3) unassembled forward reads
    (4) unassembled reverse reads</p>
<p>The default log file &ldquo;pear_summary_log.txt&rdquo; contains the percent of reads either assembled, discarded or unassembled.</p>
<div class="admonition note">
<p class="admonition-title">Question 1</p>
<p>What percent of reads were successfully stitched for sample 40CMK6WT?</p>
</div>
<h3 id="filtering-reads-by-quality-and-length">Filtering reads by quality and length<a class="headerlink" href="#filtering-reads-by-quality-and-length" title="Permanent link">&para;</a></h3>
<p>We will now filter our reads on a quality score cut-off of 30 over 90% of bases and at a maximum length of 400 bp, which are considered reasonable filtering criteria (~2 min on 1 CPU):</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/Desktop/16S_chemerin_tutorial
read_filter.pl<span class="w"> </span>-q<span class="w"> </span><span class="m">30</span><span class="w"> </span>-p<span class="w"> </span><span class="m">90</span><span class="w"> </span>-l<span class="w"> </span><span class="m">400</span><span class="w"> </span>-thread<span class="w"> </span><span class="m">4</span><span class="w"> </span>-c<span class="w"> </span>both<span class="w"> </span>stitched_reads/*.assembled*fastq
</code></pre></div>
<p>The <strong>&ldquo;-c both&rdquo;</strong> option above checks for the default forward and reverse degenerate primer sequences to match exactly in each sequences (You can use whatever primer sequences you want. However, the primer sequences in this case are set by default in the script, which you can look at with <strong>&ldquo;read_filter.pl -h&rdquo;</strong>). If you don&rsquo;t set the <strong>&ldquo;-c&rdquo;</strong> option to either <strong>&ldquo;both&rdquo;</strong> or <strong>&ldquo;forward&rdquo;</strong> then there wont be any primer matching.</p>
<p>By default this script will output filtered FASTQs in a folder called <strong>&ldquo;filtered_reads&rdquo;</strong> and the percent of reads thrown out after each filtering step is recorded in <strong>&ldquo;read_filter_log.txt&rdquo;</strong>. This script is just a convenient way to run two popular tools for read filtering: <strong>FASTX-toolkit and BBMAP</strong>.</p>
<p>If you look in this logfile you will note that ~40% of reads were filtered out for each sample. You can also see the counts and percent of reads dropped at each step.</p>
<div class="admonition note">
<p class="admonition-title">Question 2</p>
<p>How many reads of sample 36CMK6WT were filtered out for not containing a match to the forward primer (which is the default setting in this case).</p>
</div>
<h3 id="conversion-to-fasta-and-removal-of-chimeric-reads">Conversion to FASTA and removal of chimeric reads<a class="headerlink" href="#conversion-to-fasta-and-removal-of-chimeric-reads" title="Permanent link">&para;</a></h3>
<p>The next steps in the pipeline require the simple conversion of sequences from FASTQ to FASTA format, using the following command (&lt; 1 min on 1 CPU):</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/Desktop/16S_chemerin_tutorial
run_fastq_to_fasta.pl<span class="w"> </span>-p<span class="w"> </span><span class="m">4</span><span class="w"> </span>-o<span class="w"> </span>fasta_files<span class="w"> </span>filtered_reads/*fastq
</code></pre></div>
<p>Note that this command removes any sequences containing &ldquo;N&rdquo; (a fully ambiguous base read), which is &lt;&lt; 1% of the reads after the read filtering steps above.</p>
<p>During PCA amplification 16S rRNA sequences from different organisms can sometimes combine to form hybrid molecules called chimeric sequences. It&rsquo;s important to remove these so they aren&rsquo;t incorrectly called as novel Operational Taxonomic Units (OTUs). Unfortunately, not all chimeric reads will be removed during this step, which is something to keep in mind during the next steps.</p>
<p>You can run chimera checking with VSEARCH with this command (~3 min on 1 CPU):</p>
<div class="highlight"><pre><span></span><code>chimera_filter.pl<span class="w"> </span>-type<span class="w"> </span><span class="m">1</span><span class="w"> </span>-thread<span class="w"> </span><span class="m">4</span><span class="w"> </span>-db<span class="w"> </span>/home/shared/rRNA_db/Bacteria_RDP_trainset15_092015.fa<span class="w"> </span>fasta_files/*fasta
</code></pre></div>
<p>This script will remove any reads called either ambiguously or as chimeric, and output the remaining reads in the &ldquo;non_chimeras&rdquo; folder by default.</p>
<p>By default the logfile &ldquo;chimeraFilter_log.txt&rdquo; is generated containing the counts and percentages of reads filtered out for each sample.</p>
<div class="admonition note">
<p class="admonition-title">Question 3</p>
<p>What is the mean percent of reads retained after this step, based on the output in the log file (&ldquo;nonChimeraCallsPercent&rdquo; column)?</p>
</div>
<div class="admonition note">
<p class="admonition-title">Question 4</p>
<p>What percent of stitched reads was retained for sample 75CMK8KO after all the filtering steps </p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>&ldquo;you will need to compare the original number of reads to the number of reads output by chimera_filter.pl)?&rdquo;</p>
</div>
<h3 id="assign-samples-to-the-reads">Assign samples to the reads<a class="headerlink" href="#assign-samples-to-the-reads" title="Permanent link">&para;</a></h3>
<p>Now that we have adequately prepared the reads, we can now run OTU picking using QIIME. An Operational Taxonomic Unit (<strong>OTU</strong>) defines a taxonomic group based on sequence similarity among sampled organisms. QIIME software clusters sequence reads from microbial communities in order to classify its constituent micro-organisms into OTUs. QIIME requires FASTA files to be input in a specific format (specifically, sample names need to be at the beginning of each header line). We have provided the mapping file (<strong>&ldquo;map.txt&rdquo;</strong>), which links filenames to sample names and metadata.</p>
<p>As we saw the map.txt (e.g. with <strong>less -S</strong>) had 2 columns without any data: &ldquo;<strong>BarcodeSequence</strong>&rdquo; and &ldquo;<strong>LinkerPrimerSequence</strong>&rdquo;. We don&rsquo;t need to use these columns today. These would normally be populated for multiplexed data.</p>
<p>Also, you will see that the &ldquo;<strong>FileInput</strong>&rdquo; column contains the names of each FASTA file, which is what we need to specify for the command below.</p>
<p>This command will correctly format the input FASTA files and output a single FASTA:</p>
<div class="highlight"><pre><span></span><code>add_qiime_labels.py<span class="w"> </span>-i<span class="w"> </span>non_chimeras/<span class="w"> </span>-m<span class="w"> </span>map.txt<span class="w"> </span>-c<span class="w"> </span>FileInput<span class="w"> </span>-o<span class="w"> </span>combined_fasta<span class="w"> </span>
</code></pre></div>
<p>If you take a look at <strong>combined_fasta/combined_seqs.fna</strong> you can see that the first column of header line is a sample name taken from the mapping file.</p>
<h3 id="de-novo-otu-picking">De novo OTU picking<a class="headerlink" href="#de-novo-otu-picking" title="Permanent link">&para;</a></h3>
<p>Now that the input file has been correctly formatted we can run the actual OTU picking program.</p>
<p>Several parameters for this program can be specified into a text file, which will be read in by &ldquo;pick_open_reference_otus.py&rdquo;:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;pick_otus:threads 1&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>clustering_params.txt
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;pick_otus:sortmerna_coverage 0.8&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>clustering_params.txt
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;pick_otus:sortmerna_db /home/shared/pick_otu_indexdb_rna/97_otus&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>clustering_params.txt
</code></pre></div>
<p>We will be using the <strong>uclust method</strong> of <strong>open-reference OTU picking</strong>. In open-reference OTU picking, reads are first clustered against a reference database; then, a certain percent (10% in the below command) of those reads that failed to be classified are sub-sampled to create a new reference database and the remaining unclassified reads are clustered against this new database. This <strong>de novo</strong> clustering step is repeated again by default using the below command (can be turned off to save time with the <strong>&ldquo;–suppress_step4&rdquo;</strong> option).</p>
<p>We are actually also retaining singletons (i.e. OTUs identified by 1 read), which we will then remove in the next step. Note that &ldquo;<strong>$PWD</strong>&rdquo; is just a variable that contains the path to your current directory. This command takes ~7 min with 1 CPU. Lowering the &ldquo;<strong>-s</strong>&rdquo; parameter&rsquo;s value will greatly affect running speed.</p>
<div class="highlight"><pre><span></span><code>pick_open_reference_otus.py<span class="w"> </span>-i<span class="w"> </span><span class="nv">$PWD</span>/combined_fasta/combined_seqs.fna<span class="w"> </span>-o<span class="w"> </span><span class="nv">$PWD</span>/clustering/<span class="w"> </span>-p<span class="w"> </span><span class="nv">$PWD</span>/clustering_params.txt<span class="w"> </span>-m<span class="w"> </span>sortmerna_sumaclust<span class="w"> </span>-s<span class="w"> </span><span class="m">0</span>.1<span class="w"> </span>-v<span class="w"> </span>--min_otu_size<span class="w"> </span><span class="m">1</span>
</code></pre></div>
<h3 id="remove-low-confidence-otus">Remove low confidence OTUs<a class="headerlink" href="#remove-low-confidence-otus" title="Permanent link">&para;</a></h3>
<p>We will now remove low confidence OTUs, i.e. those that are called by a low number of reads. It&rsquo;s difficult to choose a hard cut-off for how many reads are needed for an OTU to be confidently called, since of course OTUs are often at low frequency within a community. A reasonable approach is to remove any OTU identified by fewer than 0.1% of the reads, given that 0.1% is the estimated amount of sample bleed-through between runs on the Illumina Miseq:</p>
<div class="highlight"><pre><span></span><code>remove_low_confidence_otus.py -i $PWD/clustering/otu_table_mc1_w_tax_no_pynast_failures.biom -o $PWD/clustering/otu_table_high_conf.biom
</code></pre></div>
<p>Since we are just doing a test run with few sequences, the threshold is 1 OTU regardless. However, this is an important step with real datasets. Note: Sequence errors can give rise to spurious OTUs, we can filter out OTUs that only contain a single sequence (singletons). QIIME allows you to do this quite easily, or you could also remove abundant taxa if you are more interested in rare taxa.</p>
<p>We can compare the summaries of these two BIOM files:</p>
<div class="highlight"><pre><span></span><code>biom summarize-table -i clustering/otu_table_mc1_w_tax_no_pynast_failures.biom -o clustering/otu_table_mc1_w_tax_no_pynast_failures_summary.txt

biom summarize-table -i clustering/otu_table_high_conf.biom -o clustering/otu_table_high_conf_summary.txt
</code></pre></div>
<p>The first four lines of clustering/otu_table_mc1_w_tax_no_pynast_failures_summary.txt are:</p>
<div class="highlight"><pre><span></span><code>Num samples: 24
Num observations: 2420
Total count: 12014
Table density (fraction of non-zero values): 0.097
This means that for the 24 separate samples, 2420 OTUs were called based on 12014 reads. Only 9.7% of the values in the sample x OTU table are non-zero, meaning that most OTUs are in a small number of samples.
</code></pre></div>
<p>In contrast, the first four lines of clustering/otu_table_high_conf_summary.txt are:</p>
<div class="highlight"><pre><span></span><code>Num samples: 24
Num observations: 884
Total count: 10478
Table density (fraction of non-zero values): 0.193
</code></pre></div>
<p>After removing low-confidence OTUs, only <strong>36.5%</strong> were retained: <strong>the number of OTUs dropped from 2420 to 884</strong>. This effect is generally even more drastic for bigger datasets. However, the numbers of reads only dropped from 12014 to 10478 (so <strong>87% of the reads were retained</strong>). You can also see that the table density increased, as we would expect.</p>
<p>The pipeline creates a Newick-formatted phylogenetic
tree <strong>(*.tre)</strong> in the clustering directory.
You can run the program ’figtree’ from the terminal, a graphic interface will be launched by typing ’figtree’ then hit the return key. </p>
<p><div class="highlight"><pre><span></span><code>figtree
</code></pre></div>
View the tree by opening the file ’<em>.tre’ in the ’clustering’ folder *</em>(Desktop-&gt;Taxonomy-&gt;otus)**. The tree that is produced is too complex to be of much use. We will look at a different tool, Megan 6, which produces a far more useful tree. </p>
<p>Megan can be opened from the terminal by typing <strong>MEGAN</strong>. If you are asked for a licence select the following file /mnt/workshop/data/HT_MEGAN5_registration_for_academic_use.txt. From the File menu select Import -&gt; BIOM format.
Find your biom file and import it.</p>
<p>Megan will generate a tree that is far more informative than the one produced with FigTree. You can change the way Megan displays the data by clicking on the various icons and menu items. Please spend some time exploring your data.</p>
<p>The Word Cloud visualization is interesting, too, if you want to find out which samples are similar and which samples stand out.</p>
<h3 id="view-otu-statistics">View OTU statistics<a class="headerlink" href="#view-otu-statistics" title="Permanent link">&para;</a></h3>
<p>You can generate some statistics, e.g. the number of reads assigned, distribution among samples. Some of the statistics are useful for further downstream analysis, e.g. beta-diversity analysis.  <strong>Write down the minimum value under Counts/sample summary</strong>. We need it for beta-diversity analysis.
You can look at the read depth per sample in <strong>clustering/otu_table_high_conf_summary.txt</strong>, here are the first five samples (they are sorted from smallest to largest):</p>
<div class="highlight"><pre><span></span><code>Counts/sample detail:
106CHE6WT: 375.0
111CHE6KO: 398.0
39CMK6KO: 410.0
113CHE6WT: 412.0
108CHE6KO: 413.0
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Question 5</p>
<p>What is the read depth for sample &ldquo;75CMK8KO&rdquo;?</p>
</div>
<p>We need to subsample the number of reads for each sample to the same depth, which is necessary for several downstream analyses. This is called <strong>rarefaction</strong>, a technique that provides an indication of <strong>species richness</strong> for a given number of samples. First it indicates if you have sequence enough to identify all species. Second we want to rarify the read depth of samples to a similar number of reads for comparative analysis. There is actually quite a lot of debate about whether rarefaction is necessary (since it throws out data), but it is still the standard method used in microbiome studies. We want to rarify the read depth to the sample with the lowest &ldquo;reasonable&rdquo; number of reads. Of course, a &ldquo;reasonable&rdquo; read depth is quite subjective and depends on how much variation there is between samples.</p>
<h3 id="rarify-reads">Rarify reads<a class="headerlink" href="#rarify-reads" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>mkdir final_otu_tables
single_rarefaction.py -i clustering/otu_table_high_conf.biom -o final_otu_tables/otu_table.biom -d 355
</code></pre></div>
<h3 id="visualize-taxonomic-composition">Visualize taxonomic composition<a class="headerlink" href="#visualize-taxonomic-composition" title="Permanent link">&para;</a></h3>
<hr />
<p>We will now group sequences by taxonomic assignment at various levels. The following command produces a number of charts that can be viewed in a browser. The command takes about 5 minutes to complete</p>
<div class="highlight"><pre><span></span><code>summarize_taxa_through_plots.py -i final_otu_tables/otu_table.biom -o  wf_taxa_summary -m map.txt 
</code></pre></div>
<p>To view the output, open a web browser from the Applications -&gt;Internet menu. You can use Google chrome, Firefox or Chromium. In  Firefox use the File menu to select </p>
<div class="highlight"><pre><span></span><code>Desktop -&gt;;Taxonomy -&gt;; wf_taxa_summary -&gt;; taxa_summary_plots 
and open either area_charts.html or bar_chars.html. 
</code></pre></div>
<p>I prefer the bar charts myself. The top chart visualizes taxonomic composition at phylum level for each of the samples. The next chart goes down to class level and following charts go another level up again. The charts (particularly the ones more at the top) are very useful for discovering how the communities in your samples differ from each other. </p>
<h3 id="alpha-diversity-within-samples-and-rarefaction-curves">Alpha diversity within samples and rarefaction curves<a class="headerlink" href="#alpha-diversity-within-samples-and-rarefaction-curves" title="Permanent link">&para;</a></h3>
<hr />
<p>Alpha diversity is the microbial diversity within a sample. QIIME can calculate a lot of metrics, but for our tutorial, we generate 3 metrics from the alpha rarefaction workflow: chao1 (estimates species richness); observed species metric (the count of unique OTUs); phylogenetic distance. The following workflow generates rarefaction plots to visualize alpha diversity.</p>
<p>Run the following command from within your taxonomy directory, this should take a few minutes:</p>
<div class="highlight"><pre><span></span><code>alpha_rarefaction.py<span class="w"> </span>-i<span class="w"> </span>final_otu_tables/otu_table.biom<span class="w"> </span>-o<span class="w"> </span>plots/alpha_rarefaction_plot<span class="w"> </span>-t<span class="w"> </span>clustering/rep_set.tre<span class="w"> </span>--min_rare_depth<span class="w"> </span><span class="m">40</span><span class="w"> </span>--max_rare_depth<span class="w"> </span><span class="m">355</span><span class="w"> </span>-m<span class="w"> </span>map.txt<span class="w">  </span>--num_steps<span class="w"> </span><span class="m">10</span>
</code></pre></div>
<p>First we are going to view the rarefaction curves in a web browser by opening the resulting HTML file to view the plots: </p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>plots/alpha_rarefaction_plot/alpha_rarefaction_plots/rarefaction_plots.html
</code></pre></div></td></tr></table></div>

<p>Choose &ldquo;observed_otus&rdquo; as the metric and &ldquo;Source&rdquo; as the category. You should see this plot:</p>
<p><img alt="Alpha-diversity-plot" src="../images/ADIV.png" /></p>
<p>There is no difference in the number of OTUs identified in the guts of mice from the BZ facility than the CJS facility, based on this dataset. However, since the rarefaction curves have not reached a plateau, it is likely that this comparison is just incorrect to make with so few reads. Indeed, with the full dataset you do see a difference in the number of OTUs.</p>
<p>In general the more reads you have, the more OTUs you will observe. If a rarefaction curve start to flatten, it means that you have probably sequenced at sufficient depth, in other words, producing more reads will not significantly add more OTUs. If on the other hand hasn’t flattened, you have not sampled enough to capture enough of the microbial diversity and by extrapolating the curve you may be able to estimate how many more reads you will need. Consult the QIIME overview tutorial for further information.</p>
<p>Run the following command from within your taxonomy directory, this should take a few minutes to generate a heatmap of the level three taxonomy:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>make_otu_heatmap.py -i final_otu_tables/otu_table_L3.biom -o final_otu_tables/otu_table_L3_heatmap.pdf -c Treatment -m map.txt
</code></pre></div></td></tr></table></div>

<h3 id="beta-diversity-and-beta-diversity-plots">Beta diversity and beta diversity plots<a class="headerlink" href="#beta-diversity-and-beta-diversity-plots" title="Permanent link">&para;</a></h3>
<p>Beta diversity analysis, is the assessment of differences between microbial communities/samples. As we have already observed, our samples contain different numbers of sequences. The first step is to remove sample heterogeneity by randomly selecting the same number of reads from every sample. This number corresponds to the ’minimum’ number recorded when you looked at the OTU statistics.  Now run the following command</p>
<div class="highlight"><pre><span></span><code>beta_diversity_through_plots.py<span class="w"> </span>-i<span class="w"> </span>final_otu_tables/otu_table.biom<span class="w"> </span>-m<span class="w"> </span>map.txt<span class="w"> </span>-o<span class="w"> </span>bdiv_even<span class="w"> </span>-t<span class="w"> </span>otus/rep_set.tre<span class="w"> </span>-e<span class="w"> </span><span class="m">355</span>
</code></pre></div>
<p>Good data quality and sample metadata is important for visualising metagenomics analysis. The output of these comparisons is a square matrix where a distance or dissimilarity is calculated between every pair of community samples, reflecting the dissimilarity between those samples. The data distance matrix can be then visualized with analyses such as PCoA and hierarchical clustering.</p>
<h3 id="testing-for-statistical-differences">Testing for statistical differences<a class="headerlink" href="#testing-for-statistical-differences" title="Permanent link">&para;</a></h3>
<p>So what&rsquo;s the next step? Since we know that source facility is such an important factor, we could analyze samples from each facility separately. This will lower our statistical power to detect a signal, but otherwise we cannot easily test for a difference between genotypes.</p>
<p>To compare the genotypes within the two source facilities separately we fortunately don&rsquo;t need to re-run the OTU-picking. Instead, we can just take different subsets of samples from the final OTU table. First though we need to make two new mapping files with the samples we want to subset:</p>
<div class="highlight"><pre><span></span><code>head<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>map.txt<span class="w"> </span>&gt;&gt;<span class="w"> </span>map_BZ.txt<span class="p">;</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ if ( $3 == &quot;BZ&quot; ) { print $0 } }&#39;</span><span class="w"> </span>map.txt<span class="w"> </span>&gt;&gt;map_BZ.txt
head<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>map.txt<span class="w"> </span>&gt;&gt;<span class="w"> </span>map_CJS.txt<span class="p">;</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ if ( $3 == &quot;CJS&quot; ) { print $0 } }&#39;</span><span class="w"> </span>map.txt<span class="w"> </span>&gt;&gt;map_CJS.txt
</code></pre></div>
<p>These commands are split into 2 parts (separated by &ldquo;;&rdquo;). The first part writes the header line to each new mapping file. The second part is an awk command that prints any line where the 3<sup>rd</sup> column equals the id of the source facility. Note that awk splits by any whitespace by default, which is why the source facility IDs are in the 3<sup>rd</sup> column according to awk, even though we know this isn&rsquo;t true when the file is tab-delimited.</p>
<p>The BIOM &ldquo;subset-table&rdquo; command requires a text file with 1 sample name per line, which we can generate by these quick bash commands:</p>
<div class="highlight"><pre><span></span><code>tail<span class="w"> </span>-n<span class="w"> </span>+2<span class="w">  </span>map_BZ.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>samples_BZ.txt
tail<span class="w"> </span>-n<span class="w"> </span>+2<span class="w">  </span>map_CJS.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>samples_CJS.txt
</code></pre></div>
<p>These commands mean that the first line (the header) should be ignored and then the first column should be printed to a new file. We can now take the two subsets of samples from the BIOM file:</p>
<p><div class="highlight"><pre><span></span><code>biom<span class="w"> </span>subset-table<span class="w"> </span>-i<span class="w"> </span>final_otu_tables/otu_table.biom<span class="w"> </span>-a<span class="w"> </span>sample<span class="w"> </span>-s<span class="w"> </span>samples_BZ.txt<span class="w"> </span>-o<span class="w"> </span>final_otu_tables/otu_table_BZ.biom
biom<span class="w"> </span>subset-table<span class="w"> </span>-i<span class="w"> </span>final_otu_tables/otu_table.biom<span class="w"> </span>-a<span class="w"> </span>sample<span class="w"> </span>-s<span class="w"> </span>samples_CJS.txt<span class="w"> </span>-o<span class="w"> </span>final_otu_tables/otu_table_CJS.biom
</code></pre></div>
We can now re-create the beta diversity plots for each subset:</p>
<p><div class="highlight"><pre><span></span><code>beta_diversity_through_plots.py<span class="w"> </span>-m<span class="w"> </span>map_BZ.txt<span class="w"> </span>-t<span class="w"> </span>clustering/rep_set.tre<span class="w"> </span>-i<span class="w"> </span>final_otu_tables/otu_table_BZ.biom<span class="w"> </span>-o<span class="w"> </span>plots/bdiv_otu_BZ<span class="w"> </span>
beta_diversity_through_plots.py<span class="w"> </span>-m<span class="w"> </span>map_CJS.txt<span class="w"> </span>-t<span class="w"> </span>clustering/rep_set.tre<span class="w"> </span>-i<span class="w"> </span>final_otu_tables/otu_table_CJS.biom<span class="w"> </span>-o<span class="w"> </span>plots/bdiv_otu_CJS
</code></pre></div>
We can now take a look at whether the genotypes separate in the re-generated weighted beta diversity PCoAs for each source facility separately.</p>
<p>For the BZ source facility:</p>
<p><img alt="PCA-plot-BZ" src="../images/PCA4.png" /></p>
<p>And for the CJS source facility:</p>
<p><img alt="PCA-plot-PAC5" src="../images/PCA5.png" /></p>
<p>Just by looking at these PCoA plots it&rsquo;s clear that if there is any difference it&rsquo;s subtle. To statistically evaluate whether the weighted UniFrac beta diversities differ among genotypes within each source facility, you can run an analysis of similarity (ANOSIM) test. These commands will run the ANOSIM test and change the output filename:</p>
<p><div class="highlight"><pre><span></span><code>compare_categories.py --method anosim -i plots/bdiv_otu_BZ/weighted_unifrac_dm.txt -m map_BZ.txt -c genotype -o beta_div_tests
mv beta_div_tests/anosim_results.txt  beta_div_tests/anosim_results_BZ.txt 
</code></pre></div>
<div class="highlight"><pre><span></span><code>compare_categories.py --method anosim -i plots/bdiv_otu_CJS/weighted_unifrac_dm.txt -m map_CJS.txt -c genotype -o beta_div_tests
mv beta_div_tests/anosim_results.txt  beta_div_tests/anosim_results_CJS.txt
</code></pre></div></p>
<p>You can take a look at the output files to see significance values and test statistics. The P-values for both tests are &gt; 0.05, so there is no significant difference in the UniFrac beta diversities of different genotypes within each source facility.</p>
<h3 id="unifrac-beta-diversity-analysis">UniFrac beta diversity analysis<a class="headerlink" href="#unifrac-beta-diversity-analysis" title="Permanent link">&para;</a></h3>
<p>UniFrac is a particular beta-diversity measure that analyzes dissimilarity between samples, sites, or communities. We will now create UniFrac beta diversity (both <strong>weighted</strong> and <strong>unweighted</strong>) principal coordinates analysis (<strong>PCoA</strong>) plots. PCoA plots are related to principal components analysis (PCA) plots, but are based on any dissimilarity matrix rather than just a covariance/correlation matrix. </p>
<p><strong>Note</strong> the major difference between weighted and unweighted analysis is the inclusion of OTU abundance when calculating distances between communities. You should use weighted if the biological question you are trying to ask takes OTU abundance of your groups into consideration. If some samples are forming groups with weighted, then it&rsquo;s likely the larger or smaller abundances of several OTUs are the primary driving force in PCoA space, but when all OTUs are considered at equal abundance, these differences are lost (unweighted).</p>
<p>QIIME &ldquo;<strong>beta_diversity_through_plots.py</strong>&rdquo; takes the OTU table as input, as well as file which contains the phylogenetic relatedness between all clustered OTUs. One HTML file will be generated for the weighted and unweighted beta diversity distances:</p>
<div class="highlight"><pre><span></span><code>plots/bdiv_otu/weighted_unifrac_emperor_pcoa_plot/index.html
plots/bdiv_otu/unweighted_unifrac_emperor_pcoa_plot/index.html
</code></pre></div>
<p>Open the weighted HTML file in your browser and take a look, you should see a PCoA very similar to this:</p>
<p><img alt="Beta-diversity-unifrac-weighted" src="../images/PCA1.png" /></p>
<p>The actual metadata we are most interested in for this dataset is the &ldquo;genotype&rdquo; column of the mapping file, which contains the different genotypes I described at the beginning of this tutorial. Go to the &ldquo;Colors&rdquo; tab of the Emperor plot (which is what we were just looking at) and change the selection from &ldquo;BarcodeSequence&rdquo; (default) to &ldquo;genotype&rdquo;. You should see a similar plot to this:</p>
<p><img alt="Beta-diversity-unifrac-weighted-genotype" src="../images/PCA2.png" /></p>
<p>The WT genotype is spread out across both knockout genotypes, which is not what we would have predicted.</p>
<p>You&rsquo;ll see what&rsquo;s really driving the differences in beta diversity when you change the selection under the &ldquo;Colors&rdquo; tab from &ldquo;genotype&rdquo; to &ldquo;Source&rdquo;:</p>
<p><img alt="Beta-diversity-unifrac-weighted-source" src="../images/PCA3.png" /></p>
<h3 id="using-stamp-to-test-for-particular-differences">Using STAMP to test for particular differences<a class="headerlink" href="#using-stamp-to-test-for-particular-differences" title="Permanent link">&para;</a></h3>
<p>Often we&rsquo;re interested in figuring out which particular taxa (or other feature such as functions) differs in relative abundance between groups. There are many ways this can be done, but one common method is to use the easy-to-use program <strong>STAMP</strong>. We&rsquo;ll run STAMP on the full OTU table to figure out which genera differ between the two source facilities as an example.</p>
<p>Before running STAMP we need to convert our OTU table into a format that STAMP can read:</p>
<div class="highlight"><pre><span></span><code>biom_to_stamp.py -m taxonomy final_otu_tables/otu_table.biom &gt;final_otu_tables/otu_table.spf
</code></pre></div>
<p>If you take a look at &ldquo;final_otu_tables/otu_table.spf&rdquo; with less you&rsquo;ll see that it&rsquo;s just a simple tab-delimited table.</p>
<p>Now we&rsquo;re ready to open up STAMP, which you can either do by typing STAMP on the command-line or by clicking the side-bar icon.</p>
<p>Load &ldquo;otu_table.spf&rdquo; as the Profile file and &ldquo;map.txt&rdquo; as the Group metadata file.</p>
<p>As a reminder, the full paths of these files should be:
<div class="highlight"><pre><span></span><code>/home/mh_user/Desktop/16S_chemerin_tutorial/final_otu_tables/otu_table.spf and /home/mh_user/Desktop/16S_chemerin_tutorial/map.txt
</code></pre></div></p>
<p>Change the Group field to &ldquo;Source&rdquo; and the profile level to &ldquo;Level_6&rdquo; (which corresponds to the genus level). Change the heading from &ldquo;Multiple groups&rdquo; to &ldquo;Two groups&rdquo;. The statistical test to &ldquo;Welch&rsquo;s t-test&rdquo; and the multiple test correction to &ldquo;Benjamini-Hochberg FDR&rdquo;</p>
<p>Change the plot type to &ldquo;Bar plot&rdquo;. Look at the barplot for Prevotella and save it to a file.</p>
<div class="admonition note">
<p class="admonition-title">Question</p>
<p>Can you see how many genera are significant by clicking &ldquo;Show only active features&rdquo;?</p>
</div>
<h3 id="part-2-16s-analysis-of-whole-genome-shotgun-sequencing_1">Part 2: 16S analysis of whole genome shotgun sequencing<a class="headerlink" href="#part-2-16s-analysis-of-whole-genome-shotgun-sequencing_1" title="Permanent link">&para;</a></h3>
<h3 id="closed-reference-otu-picking-of-16s-ribosomal-rrna-fragments-selected-from-a-shotgun-data-set">Closed reference OTU picking of 16S ribosomal rRNA fragments selected from a shotgun data set<a class="headerlink" href="#closed-reference-otu-picking-of-16s-ribosomal-rrna-fragments-selected-from-a-shotgun-data-set" title="Permanent link">&para;</a></h3>
<hr />
<p>In a closed-reference OTU picking process, reads are clustered against a reference sequence collection and any reads, which do not hit a sequence in the reference sequence collection, are excluded from downstream analyses. In QIIME, <strong>pick_closed_reference_otus.py</strong> is the primary interface for closed-reference OTU picking in QIIME. If the user provides taxonomic assignments for sequences in the reference database,
those are assigned to OTUs. We could use this approach to perform
taxonomic analysis on shotgun data. We need to perform the following
steps:</p>
<ol>
<li>Extract those reads from the data set that contain 16S ribosomal RNA
sequence. If there are less than (e.g.) 100 nucleotides of rRNA
sequence, the read should be discarded.</li>
<li>Remove non-rRNA sequence (flanking regions) from those reads</li>
<li>Run closed-reference OTU picking workflow</li>
<li>Visualise the results, e.g. in Megan</li>
</ol>
<h3 id="extraction-of-16s-rrna-sequence-containing-reads-with-rrnaselector">Extraction of 16S rRNA sequence-containing reads with rRNASelector<a class="headerlink" href="#extraction-of-16s-rrna-sequence-containing-reads-with-rrnaselector" title="Permanent link">&para;</a></h3>
<hr />
<p>We will analyze an Illumina paired-end dataset that has been drastically reduced in size for this tutorial, while preserving the majority of the 16S containing reads. The dataset is from the metagenome described at
<a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3772140/">http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3772140/</a>. There is a pdf in the working directory for this part of the tutorial. This is a paired end dataset, and where read pairs overlapped, they were merged into a single sequence. If read pairs did not overlap, both reads were included in the analysis. QC was performed using the EBI Metagenomics pipeline. We will use a tool called rRNASelector, which is freely available
(<a href="http://www.ncbi.nlm.nih.gov/pubmed/21887657">http://www.ncbi.nlm.nih.gov/pubmed/21887657</a>) to select our 16S rRNA sequence containing reads. The tool invokes hmmsearch and uses trained hidden Markov models to detect reads with 16S rRNA sequence. The tool also trims the reads so that only 16S rRNA sequence is present in the fasta file we will feed into the QIIME workflow.</p>
<p>First, we need to go to our working directory. You will find a file called A7A-paired.fasta containing the sequence reads. Fire up <strong>rRNASelector</strong> from the command line.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>cd ~/Desktop/Taxonomy/A7A/
rRNASelector
</code></pre></div></td></tr></table></div>

<p>A graphical interface should appear. Note interaction with the interface may have a few seconds lag. </p>
<ol>
<li>Load the sequence file by clicking on ’File Choose’ at the top and navigate to the file A7A-paired.fasta. </li>
<li>Select the file and click ’Open’. The tool will automatically fill in file names for the result files.</li>
<li>Change the Number of CPUs to ’4’ </li>
<li>Select Prokaryote 16S (to include both bacterial and archaeal 16S sequences) </li>
<li>Specify the location of the hmmsearch file by clicking the second ’File Choose’ button. Type in manually the location &lsquo;<strong>/usr/bin/hmmsearch</strong>&rsquo;, </li>
<li>Then click process. The run should take a few minutes to complete.</li>
</ol>
<p>If all went well, you can close rRNASelector by clicking on Exit. You will have 3 new files in your directory, one containing untrimmed 16S reads, one containing trimmed 16S reads (<strong>A7A-paired.prok.16s.trim.fasta</strong>; that’s the one we want) and a file containing reads that do not contain (sufficient) 16S sequence.</p>
<h3 id="closed-reference-otu-picking-workflow-and-visualization-of-results-in-megan-6">Closed-reference OTU picking workflow and visualization of results in Megan 6<a class="headerlink" href="#closed-reference-otu-picking-workflow-and-visualization-of-results-in-megan-6" title="Permanent link">&para;</a></h3>
<hr />
<p>We are now ready to pick our OTUs. We do that by running the following
command (all on one line and no space after gg_otus-12-10):</p>
<div class="highlight"><pre><span></span><code>pick_closed_reference_otus.py -i A7A-paired.prok.16s.trim.fasta -o ./cr_uc -r /mnt/workshop/tools/qiime_software/gg_otus-12_10-release/rep_set/97_otus.fasta -t /mnt/workshop/tools/qiime_software/gg_otus-12_10-release/taxonomy/97_otu_taxonomy.txt
</code></pre></div>
<p>We need to specify the following options. The command will take several minutes to run. When finished open Megan as described before, import the otu_table.biom file and explore the results.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>-i input_file.fasta
-o output_directory
-r /path/to/reference_sequences
-t /path/to/reference_taxonomy
</code></pre></div></td></tr></table></div>

<h3 id="bonus">Bonus<a class="headerlink" href="#bonus" title="Permanent link">&para;</a></h3>
<hr />
<p>The QIIME overview tutorial at
(<a href="http://qiime.org/tutorials/tutorial.html">http://qiime.org/tutorials/tutorial.html</a>) has a number of additional steps that you may find interesting; so feel free to try some of them out. Note hat we have not installed Cytoscape, so we cannot visualize OTU networks.</p>
<p>We will end this tutorial with a summary of what we have done and how well our analysis compares with the one in the paper.</p>
<p>Hopefully you will have acquired new skills that allow you to tackle your own taxonomic analyses. There are many more tutorials on the QIIME website that can help you pick the best strategy for your project (<a href="http://qiime.org/tutorials/">http://qiime.org/tutorials/</a>) and <a href="https://github.com/mlangill/microbiome_helper/wiki/">https://github.com/mlangill/microbiome_helper/wiki/</a>. There are alternatives that might suit your need better (e.g. VAMPS at <a href="http://vamps.mbl.ed">http://vamps.mbl.ed</a>&gt;; mothur at <a href="http://www.mothur.org">http://www.mothur.org</a>) and others.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; The authors; 2017-
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.12658920.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.5cf534bf.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../../js/details.js"></script>
      
    
  </body>
</html>